<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>PL/0 language compiler(in PASCAL) | ydleenudt</title>
  <meta name="author" content="Victor Lee">
  
  <meta name="description" content="CS | Medcine | military | Python">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="PL/0 language compiler(in PASCAL)"/>
  <meta property="og:site_name" content="ydleenudt"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="ydleenudt" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">ydleenudt</a></h1>
  <h2><a href="/">Life&#39;s A Struggle</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">首页</a></li>
    
      <li><a href="/archives">存档</a></li>
    
      <li><a href="about">关于</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-06-26T17:23:56.000Z"><a href="/2015/06/27/PL-0-language-compiler-in-PASCAL/">2015-06-27</a></time>
      
      
  
    <h1 class="title">PL/0 language compiler(in PASCAL)</h1>
  

    </header>
    <div class="entry">
      
        <h4 id="General_Information">General Information</h4><ul>
<li>PL/0语言编译程序的语法分析技术采用的是自顶向下递归子程序法</li>
<li>PL/0语言编译程序的整体结构包括词法分析、语法分析、语义分析、代码生成及符号表管理，每个过程的功能相互联系</li>
<li>PL/0语言编译程序的目标程序在运行时采用栈式动态存储管理的实现技术</li>
<li>◇标识符的有效长度是10<br>◇ 数字最多为14位<br>◇ 过程最多可嵌套三层，可递归调用<br>◇ 标识符的作用域同PASCAL，内层可引用包围它的外层定义的标识符（如：变量名，过程名，常量名）</li>
<li>编译过程采用一趟扫描方式，以语法分析程序为核心，词法分析程序和代码生成程序都作为一个独立的过程，当语法分析需要读单词时就调用词法分析程序，而当语法分析正确需生成相应的目标代码时，则调用代码生成程序。</li>
<li>用出错处理程序对词法和语法分析遇到的错误给出在源程序中出错的位置和错误性质</li>
<li>用表格管理程序建立变量、常量和过程标识符的说明与引用之间的信息联系</li>
</ul>
<a id="more"></a>
<h4 id="语法描述">语法描述</h4><p>程序语法描述<br><img src="http://ww4.sinaimg.cn/large/a656b2e0gw1ethzrk6xkej205n00zt8k.jpg" alt="程序语法描述"></p>
<p>分程序语法描述<br><img src="http://ww4.sinaimg.cn/large/a656b2e0gw1ethzsdrvlsj20ba09ot9k.jpg" alt="分程序语法描述"></p>
<p>语句语法描述图<br><img src="http://ww2.sinaimg.cn/large/a656b2e0gw1ethzszev8ej20by0bvjss.jpg" alt="语句语法描述图"></p>
<p>条件语法描述图（带条件转换的boolean语句）<br><img src="http://ww1.sinaimg.cn/large/a656b2e0gw1ethztiluu7j20by043jrq.jpg" alt="条件语法描述图"></p>
<p>表达式语法描述<br><img src="http://ww1.sinaimg.cn/large/a656b2e0gw1ethztznmbxj20by03j3yl.jpg" alt="表达式语法描述"></p>
<p>项语法描述<br><img src="http://ww2.sinaimg.cn/large/a656b2e0gw1ethzuo4scdj20by046t8s.jpg" alt="项语法描述"></p>
<p>因子语法描述<br><img src="http://ww2.sinaimg.cn/large/a656b2e0gw1ethzv69pisj20by044jrj.jpg" alt="因子语法描述"></p>
<h4 id="BNF表示">BNF表示</h4><p>PL/0语言文法的EBNF表示为：<br>　　〈程序〉∷=〈分程序〉．<br>　　〈分程序〉∷=[〈常量说明部分〉][〈变量说明部分〉][〈过程说明部分〉]〈语句〉<br>　　〈常量说明部分〉∷=CONST〈常量定义〉 {，〈常量定义〉}；<br>　　〈常量定义〉∷=〈标识符〉=〈无符号整数〉<br>　　〈无符号整数〉∷=〈数字〉{〈数字〉}<br>　　〈变量说明部分〉∷=VAR〈标识符〉{，〈标识符〉}；<br>　　〈标识符〉∷=〈字母〉{〈字母〉|〈数字〉}<br>　　〈过程说明部分〉∷=〈过程首部〉〈分程序〉{；〈过程说明部分〉}；<br>　　〈过程首部〉∷=PROCEDURE〈标识符〉；<br>　　〈语句〉∷=〈赋值语句〉|〈条件语句〉|〈当型循环语句〉|〈过程调用语句〉|〈读语句〉|〈写语句〉|〈复合语句〉|〈空〉<br>　　〈赋值语句〉∷=〈标识符〉∶=〈表达式〉<br>　　〈复合语句〉∷=BEGIN〈语句〉{；〈语句〉}END<br>　　〈条件〉∷=〈表达式〉〈关系运算符〉〈表达式〉|ODD〈表达式〉<br>　　〈表达式〉∷=[+|-]〈项〉{〈加法运算符〉〈项〉}<br>　　〈项〉∷=〈因子〉{〈乘法运算符〉〈因子〉}<br>　　〈因子〉∷=〈标识符〉|〈无符号整数〉|’(‘〈表达式〉’)’<br>　　〈加法运算符〉∷=+|-<br>　　〈乘法运算符〉∷=*|/<br>　　〈关系运算符〉∷=#|=|＜|＜=|＞|＞=<br>　　〈条件语句〉∷=IF〈条件〉THEN〈语句〉<br>　　〈过程调用语句〉∷=CALL〈标识符〉<br>　　〈当型循环语句〉∷=WHILE〈条件〉DO〈语句〉<br>　　〈读语句〉∷=READ’(‘〈标识符〉{，〈标识符〉}’)’<br>　　〈写语句〉∷=WRITE’(‘〈表达式〉{，〈表达式〉}’)’<br>　　〈字母〉∷=a|b|…|X|Y|Z<br>　　〈数字〉∷=0|1|2|…|8|9</p>
<h4 id="类pcode部分">类pcode部分</h4><p>目标指令有8条：<br>　　① LIT：将常量值取到运行栈顶。a域为常数值。<br>　　② LOD：将变量放到栈顶。a域为变量在所说明层中的相对位置,l为调用层<br>　　与说明层的层差值。<br>　　③ STO：将栈顶的内容送入某变量单元中。a,l域的含意同LOD指令。<br>　　④ CAL：调用过程的指令。a为被调用过程的目标程序入口地址，l为层差。<br>　　⑤ INT：为被调用的过程(或主程序)在运行栈中开辟数据区。a域为开辟的单元个数。<br>　　⑥ JMP：无条件转移指令，a为转向地址。<br>　　⑦ JPC：条件转移指令，当栈顶的布尔值为非真时，转向a域的地址，否则顺序执行。<br>　　⑧ OPR：关系运算和算术运算指令。将栈顶和次栈顶的内容进行运算，结果存放在次栈顶，此外还可以是读写等特殊功能的指令，具体操作由a域值给出。（详见解释执行程序）。</p>
<p>类pcode代码指令的详细解释（指令功能表见实验指导）<br>　　目标代码类pcode是一种假想栈式计算机的汇编语言。<br>　　指令格式：f+l+a<br>　　f 功能码<br>　　l 层次差 （标识符引用层减去定义层）<br>　　a 根据不同的指令有所区别</p>
<p>一个PL/0程序与目标代码类pcode指令的映射例子<br><img src="http://ww2.sinaimg.cn/large/a656b2e0gw1ethzvydb7zj20bz0awdiq.jpg" alt="一个PL/0程序与目标代码类pcode指令的映射例子"></p>
<h4 id="词法分析">词法分析</h4><p>全程量单元（global variable）：</p>
<ul>
<li>SYM：存放每个单词的类别，用内部编码形式表示。</li>
<li>ID：存放用户所定义的标识符的值。即标识符字符串的机内表示。<br><code>alpha</code>in code</li>
<li>NUM：存放用户定义的数。</li>
</ul>
<p>全程量单元定义在<code>procedure plcompiler</code>中<br><strong>CODE</strong><br><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ch:char;           &#123; <span class="keyword">last</span> character <span class="keyword">read</span> &#125;</span><br><span class="line">sym:symbol;        &#123; <span class="keyword">last</span> symbol <span class="keyword">read</span>&#125;</span><br><span class="line">id:alfa;           &#123; <span class="keyword">last</span> identifier <span class="keyword">read</span>  <span class="number">10</span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>单词（word）：</p>
<ul>
<li>基本字：也可称为保留字或关键字，如BEGIN，END，IF，THEN等。<br><code>oobject</code> in code representing (constant,typel,variable,prosedure)<br><code>types</code> in code representing (notyp,ints,chars,bool,arrays)</li>
<li>运算符：如：+、-、*、／、∶=、#、＞=、＜=等。</li>
<li>标识符：用户定义的变量名、常数名、过程名。</li>
<li>常数：如：10，25，100等整数。</li>
<li>界符：如：’，’、’.’、’；’、’(‘、’)’等。</li>
</ul>
<p><strong>单词的全部种类存放在symbol中</strong><br>词法分析过程GETSYM<br><img src="http://ww2.sinaimg.cn/large/a656b2e0gw1ethzwj7qxbj20by0fntah.jpg" alt="词法分析过程GETSYM"><br><code>procedure getsym</code>中对标识符和关键字（保留字）的识别方式为：</p>
<ul>
<li>当识别到字母开头的字母数字串时，先查关键字表</li>
<li>若查不到则为标识符，查到则为关键字。</li>
</ul>
<p>PL/0编译程序文本中主程序开始对关键字表置初值如下：<br><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">word[<span class="number">1</span>]:=<span class="string">'begin '</span>；word[<span class="number">2</span>]:=<span class="string">'call '</span>；</span><br><span class="line">&#123;etc.&#125;</span><br><span class="line">word[<span class="number">13</span>]:=<span class="string">'write '</span>；</span><br></pre></td></tr></table></figure></p>
<p>每个数组元素的字符长度为10，不满10个字符时，以空格补满。<br>查到时找到关键字相应的内部表示为：<br><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wsym[<span class="number">1</span>]:=beginsym; wsym[<span class="number">2</span>]:=callsym；</span><br><span class="line">&#123;etc.&#125;</span><br><span class="line">wsym[<span class="number">13</span>]:=writesym；</span><br></pre></td></tr></table></figure></p>
<p><code>procedure getsym</code>的结构为<br><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">procedure getsym;</span><br><span class="line">    procedure getch;</span><br><span class="line">    begin</span><br><span class="line">    &#123;code to be included&#125;</span><br><span class="line">    end <span class="string">&#123;getch&#125;</span></span><br><span class="line">begin</span><br><span class="line"><span class="keyword">while</span> ch=<span class="string">' '</span> <span class="keyword">do</span> getch;&#123;function_1: neglect space&#125;</span><br><span class="line">case</span><br><span class="line">&#123;code to be included&#125;</span><br><span class="line">end <span class="string">&#123;getsym&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>其中，<code>procedure getch</code>的过程如下：<br><img src="http://ww4.sinaimg.cn/large/a656b2e0gw1ethzx6qrr6j20by0d575h.jpg" alt="getch"></p>
<h4 id="getsym完成后的表达式识别部分（语法分析）">getsym完成后的表达式识别部分（语法分析）</h4><p>语法分析流程图：<br><img src="http://ww1.sinaimg.cn/large/a656b2e0gw1ethzxpbc4zj20by0g2ace.jpg" alt="语法分析流程图"></p>
<h5 id="表达式的EBNF">表达式的EBNF</h5><p>〈表达式〉∷=[+|-]〈项〉{（+|-）〈项〉}<br>〈项〉∷=〈因子〉{（*|/）〈因子〉}<br>〈因子〉∷=〈标识符〉|〈无符号整数〉|‘（’〈表达式〉‘）’ </p>
<h5 id="〈表达式〉的递归子程序实现">〈表达式〉的递归子程序实现</h5><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">procedure expr;</span><br><span class="line">　　　begin</span><br><span class="line">　　　　<span class="keyword">if</span> sym in [ plus, minus ] then</span><br><span class="line">　　　　　begin</span><br><span class="line">　　　　　　getsym; term; </span><br><span class="line">　　　　　end</span><br><span class="line">　　　　<span class="keyword">else</span> term;</span><br><span class="line">　　　　<span class="keyword">while</span> sym in [plus, minus] <span class="keyword">do</span></span><br><span class="line">　　　　　begin</span><br><span class="line">　　　　　　getsym; term;</span><br><span class="line">　　　　　end</span><br><span class="line">　　　end;</span><br></pre></td></tr></table></figure>
<h5 id="〈项〉的递归子程序实现">〈项〉的递归子程序实现</h5><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">procedure term;</span><br><span class="line">　　begin</span><br><span class="line">　　　factor;</span><br><span class="line">　　　<span class="keyword">while</span> sym in [ <span class="keyword">times</span>, slash ] <span class="keyword">do</span></span><br><span class="line">　　　begin</span><br><span class="line">　　　　getsym; factor;</span><br><span class="line">　　　end</span><br><span class="line">　　end;</span><br></pre></td></tr></table></figure>
<h5 id="〈因子〉的递归子程序实现">〈因子〉的递归子程序实现</h5><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">procedure factor;</span><br><span class="line">　　begin </span><br><span class="line">　　　<span class="keyword">if</span> sym &lt;&gt; ident then</span><br><span class="line">　　　　begin</span><br><span class="line">　　　　　<span class="keyword">if</span> sym &lt;&gt; number then</span><br><span class="line">　　　　　　begin</span><br><span class="line">　　　　　　　<span class="keyword">if</span> sym = ‘(‘ then</span><br><span class="line">　　　　　　　　begin</span><br><span class="line">　　　　　　　　　getsym;</span><br><span class="line">　　　　　　　　　expr;</span><br><span class="line">　　　　　　　　　<span class="keyword">if</span> sym = ‘)’ then </span><br><span class="line">　　　　　　　　　　getsym</span><br><span class="line">　　　　　　　　　<span class="keyword">else</span> error</span><br><span class="line">　　　　　　　　end</span><br><span class="line">　　　　　　　<span class="keyword">else</span> error</span><br><span class="line">　　　　　　end</span><br><span class="line">　　　　end</span><br><span class="line">　　end;</span><br></pre></td></tr></table></figure>
<h4 id="语法与语义分析（block部分/重点）">语法与语义分析（block部分/重点）</h4><h5 id="对变量定义的语法处理">对变量定义的语法处理</h5><p>语法：&lt;变量说明部分&gt;: := var &lt;标识符&gt;{， &lt;标识符&gt;}；<br><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> sym=varsym then</span><br><span class="line">　begin</span><br><span class="line">　　getsym;</span><br><span class="line">　　repeat</span><br><span class="line">　　　vardeclaration;(*变量说明处理*) </span><br><span class="line">　　　<span class="keyword">while</span> sym=comma <span class="keyword">do</span></span><br><span class="line">　　　　begin</span><br><span class="line">　　　　　getsym;</span><br><span class="line">　　　　　vardeclaration</span><br><span class="line">　　　　end;</span><br><span class="line">　　　<span class="keyword">if</span> sym=semicolon then</span><br><span class="line">　　　　getsym</span><br><span class="line">　　　<span class="keyword">else</span> error(<span class="number">5</span>)</span><br><span class="line">　　<span class="keyword">until</span> sym&lt;&gt;ident;</span><br><span class="line">　end;</span><br></pre></td></tr></table></figure></p>
<p>CODE in PASCAL<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">Procedure</span> <span class="title">vardeclaration</span>;</span></span><br><span class="line">　<span class="keyword">begin</span></span><br><span class="line">　　<span class="keyword">if</span> sym = ident <span class="keyword">then</span></span><br><span class="line">　　　<span class="keyword">begin</span></span><br><span class="line">　　　　enter(variable);( *调用过程enter造名字表*）</span><br><span class="line">　　　　getsym</span><br><span class="line">　　　<span class="keyword">end</span></span><br><span class="line">　　<span class="keyword">else</span> error(<span class="number">4</span>)</span><br><span class="line">　<span class="keyword">end</span><span class="comment">(*vardeclaration*)</span>;</span><br></pre></td></tr></table></figure></p>
<p><code>procedure enter</code>的实现<br><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">procedure enter(k:object );</span><br><span class="line">　begin (* enter object into table *)</span><br><span class="line">　　tx:=tx+<span class="number">1</span>;</span><br><span class="line">　　with table[tx] <span class="keyword">do</span> (* 开域语句 *）</span><br><span class="line">　　begin</span><br><span class="line">　　　name:=id;(* 表示table[tx].name:=id;名字记录在table表中 *） </span><br><span class="line">　　　kind:=k;(* 表示table[tx].kind:=k;类型记录在table表中 * )</span><br><span class="line">　　　case k of</span><br><span class="line">　　　constant: </span><br><span class="line">　　　　begin</span><br><span class="line">　　　　　<span class="keyword">if</span> num&gt;amax then</span><br><span class="line">　　　　　　begin</span><br><span class="line">　　　　　　　error(<span class="number">31</span>);</span><br><span class="line">　　　　　　　num:=<span class="number">0</span>;</span><br><span class="line">　　　　　　end;</span><br><span class="line">　　　　　val:=num;(* table[tx].val:=num;常量的值记录在table表中 *)</span><br><span class="line">　　　　end;</span><br><span class="line">　　variable: </span><br><span class="line">　　　begin</span><br><span class="line">　　　　level:=lev;（*表示table[tx].level:=lev变量定义的所在层次记录 在table表中 *） </span><br><span class="line">　　　　adr:=dx;（*表示table[tx].adr:=dx给变量分配的位置记录在table表中 *） </span><br><span class="line">　　　　dx:=dx+<span class="number">1</span>;（*给变量分配位置的指示器加<span class="number">1</span>，指向下一个变量的位置*）</span><br><span class="line">　　　end;</span><br><span class="line">　　procedur: level:=lev；</span><br><span class="line">　　　(* 表示table[tx].level:=lev;过程定义的所在层次记录在table表中 *）</span><br><span class="line">　　end(* case *); </span><br><span class="line">　end</span><br><span class="line">end(*enter*);</span><br></pre></td></tr></table></figure></p>
<p>TABLE表的信息包括：NAME，KIND，LEVEL/VAL，ADR和SIZE。<br>TABLE信息表的示例：<br><img src="http://ww2.sinaimg.cn/large/a656b2e0gw1eti00cj1xmj20by07a0tw.jpg" alt="TABLE信息表"></p>
<h5 id="过程部分处理">过程部分处理</h5><p>程序的主体是由语句构成的。处理完过程的说明后就处理由语句组成的过程体，从语法上要对语句逐句分析。当语法正确时就生成相应语句功能的目标代码。当遇到标识符的引用时就调用POSITION函数查TABLE表，看是否有过正确的定义，若已有，则从表中取相应的有关信息，供代码的生成用。若无定义则出错。</p>
<p>BLOCK对分程序的处理<br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">begin</span> <span class="comment">(*block*)</span></span><br><span class="line">　　　dx:=<span class="number">3</span>;</span><br><span class="line">　　　tx0:=tx; （*保留当前table表指针值,实际为过程名在table表中的位置*）</span><br><span class="line">　　　table[tx].adr:=cx;（*保留当前code指针值到过程名的adr域*）</span><br><span class="line">　　　gen(jmp,<span class="number">0</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure></p>
<h4 id="目标代码生成">目标代码生成</h4><ul>
<li>PL/0语言的代码生成是由过程GEN完成的。<br>GEN过程有三个参数，分别代表目标代码的功能码、层差和位移量(对不同的指令含意不同)。</li>
<li>生成的代码顺序放在数组CODE中。<br>CODE为一维数组，数组元素为记录型数据。每一个记录就是一条目标指令。</li>
<li>CX为指令的指针，由0开始顺序增加。</li>
<li>实际上目标代码的顺序是内层过程的排在前边，主程序的目标代码在最后。</li>
</ul>
<h4 id="出错处理">出错处理</h4><p>FSYS为被调用的语法分析程序开始符号合法的后继单词符号集合，FSYS示例如下<br><img src="http://ww4.sinaimg.cn/large/a656b2e0gw1ethzyg0f38j20mn08emyr.jpg" alt="FSYS示例"></p>
<ul>
<li>在进入某个语法单位时，调用TEST,检查当前符号是否属于该语法单位的开始符号集合。若不属于，则滤去开始符号和后继符号集合外的所有符号。</li>
<li>在语法单位分析结束时，调用TEST,检查当前符号是否属于调用该语法单位时应有的后继符号集合。若不属于，则滤去后继符号和开始符号集合外的所有符号。</li>
</ul>
<h5 id="PL/0出错信息表">PL/0出错信息表</h5><p>出错编号    出错原因<br>1：        常数说明中的”=”写成”∶=”。<br>2：        常数说明中的”=”后应是数字。<br>3：        常数说明中的标识符后应是”=”。<br>4：        const ,var, procedure后应为标识符。<br>5：        漏掉了’，’或’；’。<br>6：        过程说明后的符号不正确(应是语句开始符，或过程定义符)。<br>7：        应是语句开始符。<br>8：        程序体内语句部分的后跟符不正确。<br>9：        程序结尾丢了句号’.’。<br>10：   语句之间漏了’；’。<br>11：     标识符未说明。<br>12：   赋值语句中，赋值号左部标识符属性应是变量。<br>13：   赋值语句左部标识符后应是赋值号’∶=’。<br>14：   call后应为标识符。<br>15：   call后标识符属性应为过程。<br>16：   条件语句中丢了’then’。<br>17：   丢了’end”或’；’。<br>18：   while型循环语句中丢了’do’。<br>19：   语句后的符号不正确。<br>20：   应为关系运算符。<br>21：   表达式内标识符属性不能是过程。<br>22：   表达式中漏掉右括号’)’。<br>23：   因子后的非法符号。<br>24：   表达式的开始符不能是此符号。<br>31：   数越界。<br>32：   read语句括号中的标识符不是变量。</p>
<h4 id="解释程序">解释程序</h4><p>解释程序还定义了4个寄存器。<br>　　(1) I：指令寄存器。存放着当前正在解释的一条目标指令。<br>　　(2) P：程序地址寄存器。指向下一条要执行的目标程序的地址(相当目标程序CODE数组的下标)。<br>　　(3) T：栈顶寄存器。由于每个过程当它被运行时，给它分配的数据空间(下边称数据段)可分成两部分。<br>　　静态部分：包括变量存放区和三个联系单元(联系单元的作用见后)。<br>　　动态部分：作为临时工作单元和累加器用。需要时随时分配，用完后立即释放。栈顶寄存器T指出了当前栈中最新分配的单元(T也是数组S的下标)。<br>　　(4) B：基址寄存器。指向每个过程被调用时，在数据区S中给它分配的数据段起始地址，也称基地址。<br>　　为了实现对每个过程调用时给它分配数据段，也就是对即将运行的过程所需数据段进栈；过程运行结束后释放数据段，即该数据段退栈；以及嵌套过程之间对标识符引用的寻址问题。每个过程被调用时，在栈顶分配三个联系单元，这三个单元存放的内容分别为：<br>　　(1) SL：静态链：它是指向定义该过程的直接外过程(或主程序)运行时最新数据段的基地址。<br>　　(2) DL：动态链：它是指向调用该过程时正在运行过程的数据段基地址。<br>　　(3) RA：返回地址：记录调用该过程时目标程序的断点，即当时的程序地址寄存器P的值。也就是调用过程指令的下一条指令的地址。</p>
<h4 id="增加部分">增加部分</h4><h5 id="case语句">case语句</h5><p>第一步：记录表达式的标记，处理表达式，标记常量的入口位置。<br>第二步：每次将表达式的值与常量进行比较，形成跳转指令，执行完一条语句之后产生无条件跳转指令。<br><figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">casestatement</span>;</span>   &#123;<span class="keyword">case</span>&#125;</span><br><span class="line">         <span class="keyword">var</span> x:item;</span><br><span class="line">             coni,conj:integer;  </span><br><span class="line">         <span class="keyword">begin</span></span><br><span class="line">                getsym;cx1:=cx;</span><br><span class="line">                expression([ofsym]+fsys,x);cx2:=cx;</span><br><span class="line">              <span class="keyword">if</span> (x.typ = ints) <span class="keyword">or</span> (x.typ = chars)<span class="keyword">then</span> </span><br><span class="line">               <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> sym=ofsym <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                 getsym;conj:=<span class="number">0</span>;</span><br><span class="line">                 <span class="keyword">while</span> sym&lt;&gt;elsesym <span class="keyword">do</span> </span><br><span class="line">                 <span class="keyword">begin</span></span><br><span class="line">                     <span class="keyword">if</span> (sym = intcon) <span class="keyword">or</span> (sym = charcon) <span class="keyword">then</span></span><br><span class="line">                     <span class="keyword">begin</span></span><br><span class="line">                    coni:=cx1;</span><br><span class="line">                      <span class="keyword">if</span> conj&lt;&gt;<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">                      <span class="keyword">begin</span></span><br><span class="line">                      <span class="keyword">while</span> coni&lt;cx2 <span class="keyword">do</span></span><br><span class="line">                      <span class="keyword">begin</span></span><br><span class="line">                        code[cx]:=code[coni];</span><br><span class="line">                         cx:=cx+</span><br><span class="line">                         coni:=coni+<span class="number">1</span>;</span><br><span class="line">                      <span class="keyword">end</span></span><br><span class="line">                      <span class="keyword">end</span>;</span><br><span class="line">                      conj:=<span class="number">1</span>;</span><br><span class="line">                      gen(lit,<span class="number">0</span>,num);</span><br><span class="line">                      coni:=cx1;</span><br><span class="line">                      <span class="keyword">end</span></span><br><span class="line">                      <span class="keyword">else</span> error(<span class="number">12</span>);</span><br><span class="line">                      getsym;</span><br><span class="line">                       <span class="keyword">if</span> sym=colon <span class="keyword">then</span></span><br><span class="line">                       <span class="keyword">begin</span></span><br><span class="line">                          getsym;</span><br><span class="line">                          gen(eq,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                          cx2:=cx;</span><br><span class="line">                            gen(jpc,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                            statement([semicolon]+fsys);</span><br><span class="line">                       <span class="keyword">if</span> sym=semicolon <span class="keyword">then</span></span><br><span class="line">                       <span class="keyword">begin</span></span><br><span class="line">                        getsym;</span><br><span class="line">                        labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">                        gen(jmp,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                        code[cx2].a:=cx</span><br><span class="line">                         <span class="keyword">end</span></span><br><span class="line">                       <span class="keyword">else</span> error(<span class="number">23</span>)</span><br><span class="line">                      <span class="keyword">end</span></span><br><span class="line">                      <span class="keyword">else</span>  error(<span class="number">24</span>)&#123;colon&#125;</span><br><span class="line">                     <span class="keyword">end</span>;</span><br><span class="line">                   <span class="keyword">if</span> sym=elsesym <span class="keyword">then</span></span><br><span class="line">                     <span class="keyword">begin</span></span><br><span class="line">                        getsym;</span><br><span class="line">                    statement([endsym]+fsys);</span><br><span class="line">                        lx:=lx-<span class="number">1</span>;</span><br><span class="line">                         <span class="keyword">while</span> lx&gt;=<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">                         <span class="keyword">begin</span> code[labtab[lx]].a:=cx;</span><br><span class="line">                        lx:=lx-<span class="number">1</span></span><br><span class="line">                         <span class="keyword">end</span></span><br><span class="line">                  <span class="keyword">end</span>;</span><br><span class="line">                  <span class="keyword">if</span> sym=endsym <span class="keyword">then</span> getsym</span><br><span class="line">                  <span class="keyword">else</span> error(<span class="number">36</span>)</span><br><span class="line">              <span class="keyword">end</span></span><br><span class="line">              <span class="keyword">else</span> error(<span class="number">17</span>)</span><br><span class="line">             <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">end</span>;</span><br></pre></td></tr></table></figure></p>
<h5 id="repeat语句">repeat语句</h5><p>在第一条语句前记录标记，处理完语句之后，判断布尔表达式的值，并产生跳转指令。<br><figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">repeatstatement</span>;</span>&#123;<span class="keyword">repeat</span>&#125;</span><br><span class="line"><span class="keyword">var</span> x:item;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  getsym;cx1:=cx; labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">  statement([untilsym]+fsys);</span><br><span class="line">  <span class="keyword">if</span> sym&lt;&gt;semicolon <span class="keyword">then</span> error(<span class="number">23</span>);</span><br><span class="line">  getsym;</span><br><span class="line">  <span class="keyword">while</span> (<span class="keyword">not</span> (sym <span class="keyword">in</span> ([untilsym]))) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">     statement([untilsym]+fsys);</span><br><span class="line">     <span class="keyword">if</span> sym&lt;&gt;semicolon <span class="keyword">then</span> error(<span class="number">23</span>);</span><br><span class="line">     getsym</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">if</span> sym=untilsym <span class="keyword">then</span> </span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      getsym;</span><br><span class="line">      expression([endsym]+fsys,x);</span><br><span class="line">      <span class="keyword">if</span> x.typ &lt;&gt; bool <span class="keyword">then</span> error(<span class="number">34</span>); </span><br><span class="line">      gen(jpc,<span class="number">0</span>,cx1);labtab[lx]:=cx;lx:=lx+<span class="number">1</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure></p>
<h5 id="for语句">for语句</h5><p>第一步：通过词法扫描，先处理控制变量，将其装入符号表，读入初值之后存入控制变量对应的地址中。<br>第二步：读入终止值，每次判断是否满足条件，记录语句的标号，之后进入语句，处理完之后，将控制变量加一，并判断是否跳转。<br><figure class="highlight cal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">forstatement</span>;</span>&#123;<span class="keyword">for</span>&#125;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">     getsym;</span><br><span class="line">     <span class="keyword">if</span> sym=ident <span class="keyword">then</span></span><br><span class="line">     <span class="keyword">begin</span> </span><br><span class="line">             i:=position(id);getsym;</span><br><span class="line">             <span class="keyword">if</span> i=<span class="number">0</span> <span class="keyword">then</span> error(<span class="number">10</span>)</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                  <span class="keyword">if</span> nametab[i].kind&lt;&gt;variable <span class="keyword">then</span></span><br><span class="line">                     <span class="keyword">begin</span></span><br><span class="line">                     error(<span class="number">30</span>);i:=<span class="number">0</span></span><br><span class="line">                     <span class="keyword">end</span> </span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                     <span class="keyword">begin</span></span><br><span class="line">                        x.typ:=nametab[i].typ;</span><br><span class="line">            x.ref:=nametab[i].ref; </span><br><span class="line">            <span class="keyword">if</span> nametab[i].normal  </span><br><span class="line">            <span class="keyword">then</span> gen(loda,nametab[i].lev,nametab[i].adr)</span><br><span class="line">            <span class="keyword">else</span> gen(lod,nametab[i].lev,nametab[i].adr)</span><br><span class="line">           <span class="keyword">end</span>;</span><br><span class="line">       <span class="keyword">if</span> sym=becomes <span class="keyword">then</span> </span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">           getsym;</span><br><span class="line">           expression([tosym]+fsys,ini);</span><br><span class="line">             <span class="keyword">if</span>  ini.typ&lt;&gt;ints <span class="keyword">then</span> error(<span class="number">12</span>)</span><br><span class="line">             <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                     gen(sto,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                     <span class="keyword">if</span> sym=tosym <span class="keyword">then</span></span><br><span class="line">                         <span class="keyword">begin</span></span><br><span class="line">                            getsym;cx1:=cx;labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">                            gen(loda,nametab[i].lev,nametab[i].adr);</span><br><span class="line">                            gen(lodt,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                            expression([dosym]+fsys,fin);</span><br><span class="line">                          <span class="keyword">if</span> sym=dosym <span class="keyword">then</span></span><br><span class="line">                               <span class="keyword">begin</span></span><br><span class="line">                                 gen(le,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                                 cx2:=cx;labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">                                 gen(jpc,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                                     getsym;</span><br><span class="line">                                   statement(fsys);</span><br><span class="line">                                     <span class="keyword">if</span> nametab[i].normal <span class="keyword">then</span></span><br><span class="line">                                     <span class="keyword">begin</span></span><br><span class="line">                                         gen(loda,nametab[i].lev,nametab[i].adr);</span><br><span class="line">                                         gen(loda,nametab[i].lev,nametab[i].adr);</span><br><span class="line">                                   gen(lodt,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                                     <span class="keyword">end</span></span><br><span class="line">                                     <span class="keyword">else</span> gen(lod,nametab[i].lev,nametab[i].adr);</span><br><span class="line">                                     gen(lit,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">                                     gen(add,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                         gen(sto,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                         gen(jmp,<span class="number">0</span>,cx1);</span><br><span class="line">                         code[cx2].a:=cx</span><br><span class="line">                                 <span class="keyword">end</span></span><br><span class="line">                         <span class="keyword">end</span></span><br><span class="line">                      <span class="keyword">end</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">else</span> error(<span class="number">33</span>)</span><br><span class="line"><span class="keyword">end</span>;</span><br></pre></td></tr></table></figure></p>
<h4 id="完整程序">完整程序</h4><h5 id="程序结构分析">程序结构分析</h5><table>
<thead>
<tr>
<th style="text-align:left">过程或函数名</th>
<th style="text-align:left">说明</th>
<th style="text-align:left">语句</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">plcompiler</td>
<td style="text-align:left">主程序</td>
<td style="text-align:left">-</td>
</tr>
<tr>
<td style="text-align:left">error</td>
<td style="text-align:left">出错处理</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">getsym</td>
<td style="text-align:left">词法分析，读取一个单词</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">getch</td>
<td style="text-align:left">读取一个字符（忽略空格）</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">gen</td>
<td style="text-align:left">目标代码生成</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">test</td>
<td style="text-align:left">测试语句合法性</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">block</td>
<td style="text-align:left">分程序处理</td>
<td style="text-align:left">包含语法分析</td>
</tr>
<tr>
<td style="text-align:left">enter</td>
<td style="text-align:left">登陆名字表</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">position</td>
<td style="text-align:left">查找标识符在名字表中的位置</td>
<td style="text-align:left">position(id:alfa):integer</td>
</tr>
<tr>
<td style="text-align:left">constdeclaration</td>
<td style="text-align:left">常量定义处理</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">vardeclaration</td>
<td style="text-align:left">变量说明处理</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">statement</td>
<td style="text-align:left">语句部分处理</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">listcode</td>
<td style="text-align:left">列出目标代码清单</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">expression</td>
<td style="text-align:left">表达式处理</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">term</td>
<td style="text-align:left">项处理</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">factor</td>
<td style="text-align:left">因子处理</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">condition</td>
<td style="text-align:left">条件处理</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">interpret</td>
<td style="text-align:left">对目标代码的解释执行程序</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">base</td>
<td style="text-align:left">通过静态链求出数据区的基地址</td>
<td style="text-align:left">未包含在代码中？</td>
</tr>
</tbody>
</table>
<p> PL/0编译程序过程与函数定义层次结构图<br> <img src="http://ww1.sinaimg.cn/large/a656b2e0gw1eti01mz3w0j207y0cnjru.jpg" alt=" PL/0编译程序过程与函数定义层次结构图"></p>
<p>PL/0编译程序总体流程图<br><img src="http://ww1.sinaimg.cn/large/a656b2e0gw1ethzz42xnkj20by0f7q4a.jpg" alt="PL/0编译程序总体流程图"></p>
<h5 id="CODE">CODE</h5><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br><span class="line">1021</span><br><span class="line">1022</span><br><span class="line">1023</span><br><span class="line">1024</span><br><span class="line">1025</span><br><span class="line">1026</span><br><span class="line">1027</span><br><span class="line">1028</span><br><span class="line">1029</span><br><span class="line">1030</span><br><span class="line">1031</span><br><span class="line">1032</span><br><span class="line">1033</span><br><span class="line">1034</span><br><span class="line">1035</span><br><span class="line">1036</span><br><span class="line">1037</span><br><span class="line">1038</span><br><span class="line">1039</span><br><span class="line">1040</span><br><span class="line">1041</span><br><span class="line">1042</span><br><span class="line">1043</span><br><span class="line">1044</span><br><span class="line">1045</span><br><span class="line">1046</span><br><span class="line">1047</span><br><span class="line">1048</span><br><span class="line">1049</span><br><span class="line">1050</span><br><span class="line">1051</span><br><span class="line">1052</span><br><span class="line">1053</span><br><span class="line">1054</span><br><span class="line">1055</span><br><span class="line">1056</span><br><span class="line">1057</span><br><span class="line">1058</span><br><span class="line">1059</span><br><span class="line">1060</span><br><span class="line">1061</span><br><span class="line">1062</span><br><span class="line">1063</span><br><span class="line">1064</span><br><span class="line">1065</span><br><span class="line">1066</span><br><span class="line">1067</span><br><span class="line">1068</span><br><span class="line">1069</span><br><span class="line">1070</span><br><span class="line">1071</span><br><span class="line">1072</span><br><span class="line">1073</span><br><span class="line">1074</span><br><span class="line">1075</span><br><span class="line">1076</span><br><span class="line">1077</span><br><span class="line">1078</span><br><span class="line">1079</span><br><span class="line">1080</span><br><span class="line">1081</span><br><span class="line">1082</span><br><span class="line">1083</span><br><span class="line">1084</span><br><span class="line">1085</span><br><span class="line">1086</span><br><span class="line">1087</span><br><span class="line">1088</span><br><span class="line">1089</span><br><span class="line">1090</span><br><span class="line">1091</span><br><span class="line">1092</span><br><span class="line">1093</span><br><span class="line">1094</span><br><span class="line">1095</span><br><span class="line">1096</span><br><span class="line">1097</span><br><span class="line">1098</span><br><span class="line">1099</span><br><span class="line">1100</span><br><span class="line">1101</span><br><span class="line">1102</span><br><span class="line">1103</span><br><span class="line">1104</span><br><span class="line">1105</span><br><span class="line">1106</span><br><span class="line">1107</span><br><span class="line">1108</span><br><span class="line">1109</span><br><span class="line">1110</span><br><span class="line">1111</span><br><span class="line">1112</span><br><span class="line">1113</span><br><span class="line">1114</span><br><span class="line">1115</span><br><span class="line">1116</span><br><span class="line">1117</span><br><span class="line">1118</span><br><span class="line">1119</span><br><span class="line">1120</span><br><span class="line">1121</span><br><span class="line">1122</span><br><span class="line">1123</span><br><span class="line">1124</span><br><span class="line">1125</span><br><span class="line">1126</span><br><span class="line">1127</span><br><span class="line">1128</span><br><span class="line">1129</span><br><span class="line">1130</span><br><span class="line">1131</span><br><span class="line">1132</span><br><span class="line">1133</span><br><span class="line">1134</span><br><span class="line">1135</span><br><span class="line">1136</span><br><span class="line">1137</span><br><span class="line">1138</span><br><span class="line">1139</span><br><span class="line">1140</span><br><span class="line">1141</span><br><span class="line">1142</span><br><span class="line">1143</span><br><span class="line">1144</span><br><span class="line">1145</span><br><span class="line">1146</span><br><span class="line">1147</span><br><span class="line">1148</span><br><span class="line">1149</span><br><span class="line">1150</span><br><span class="line">1151</span><br><span class="line">1152</span><br><span class="line">1153</span><br><span class="line">1154</span><br><span class="line">1155</span><br><span class="line">1156</span><br><span class="line">1157</span><br><span class="line">1158</span><br><span class="line">1159</span><br><span class="line">1160</span><br><span class="line">1161</span><br><span class="line">1162</span><br><span class="line">1163</span><br><span class="line">1164</span><br><span class="line">1165</span><br><span class="line">1166</span><br><span class="line">1167</span><br><span class="line">1168</span><br><span class="line">1169</span><br><span class="line">1170</span><br><span class="line">1171</span><br><span class="line">1172</span><br><span class="line">1173</span><br><span class="line">1174</span><br><span class="line">1175</span><br><span class="line">1176</span><br><span class="line">1177</span><br><span class="line">1178</span><br><span class="line">1179</span><br><span class="line">1180</span><br><span class="line">1181</span><br><span class="line">1182</span><br><span class="line">1183</span><br><span class="line">1184</span><br><span class="line">1185</span><br><span class="line">1186</span><br><span class="line">1187</span><br><span class="line">1188</span><br><span class="line">1189</span><br><span class="line">1190</span><br><span class="line">1191</span><br><span class="line">1192</span><br><span class="line">1193</span><br><span class="line">1194</span><br><span class="line">1195</span><br><span class="line">1196</span><br><span class="line">1197</span><br><span class="line">1198</span><br><span class="line">1199</span><br><span class="line">1200</span><br><span class="line">1201</span><br><span class="line">1202</span><br><span class="line">1203</span><br><span class="line">1204</span><br><span class="line">1205</span><br><span class="line">1206</span><br><span class="line">1207</span><br><span class="line">1208</span><br><span class="line">1209</span><br><span class="line">1210</span><br><span class="line">1211</span><br><span class="line">1212</span><br><span class="line">1213</span><br><span class="line">1214</span><br><span class="line">1215</span><br><span class="line">1216</span><br><span class="line">1217</span><br><span class="line">1218</span><br><span class="line">1219</span><br><span class="line">1220</span><br><span class="line">1221</span><br><span class="line">1222</span><br><span class="line">1223</span><br><span class="line">1224</span><br><span class="line">1225</span><br><span class="line">1226</span><br><span class="line">1227</span><br><span class="line">1228</span><br><span class="line">1229</span><br><span class="line">1230</span><br><span class="line">1231</span><br><span class="line">1232</span><br><span class="line">1233</span><br><span class="line">1234</span><br><span class="line">1235</span><br><span class="line">1236</span><br><span class="line">1237</span><br><span class="line">1238</span><br><span class="line">1239</span><br><span class="line">1240</span><br><span class="line">1241</span><br><span class="line">1242</span><br><span class="line">1243</span><br><span class="line">1244</span><br><span class="line">1245</span><br><span class="line">1246</span><br><span class="line">1247</span><br><span class="line">1248</span><br><span class="line">1249</span><br><span class="line">1250</span><br><span class="line">1251</span><br><span class="line">1252</span><br><span class="line">1253</span><br><span class="line">1254</span><br><span class="line">1255</span><br><span class="line">1256</span><br><span class="line">1257</span><br><span class="line">1258</span><br><span class="line">1259</span><br><span class="line">1260</span><br><span class="line">1261</span><br><span class="line">1262</span><br><span class="line">1263</span><br><span class="line">1264</span><br><span class="line">1265</span><br><span class="line">1266</span><br><span class="line">1267</span><br><span class="line">1268</span><br><span class="line">1269</span><br><span class="line">1270</span><br><span class="line">1271</span><br><span class="line">1272</span><br><span class="line">1273</span><br><span class="line">1274</span><br><span class="line">1275</span><br><span class="line">1276</span><br><span class="line">1277</span><br><span class="line">1278</span><br><span class="line">1279</span><br><span class="line">1280</span><br><span class="line">1281</span><br><span class="line">1282</span><br><span class="line">1283</span><br><span class="line">1284</span><br><span class="line">1285</span><br><span class="line">1286</span><br><span class="line">1287</span><br><span class="line">1288</span><br><span class="line">1289</span><br><span class="line">1290</span><br><span class="line">1291</span><br><span class="line">1292</span><br><span class="line">1293</span><br><span class="line">1294</span><br><span class="line">1295</span><br><span class="line">1296</span><br><span class="line">1297</span><br><span class="line">1298</span><br><span class="line">1299</span><br><span class="line">1300</span><br><span class="line">1301</span><br><span class="line">1302</span><br><span class="line">1303</span><br><span class="line">1304</span><br><span class="line">1305</span><br><span class="line">1306</span><br><span class="line">1307</span><br><span class="line">1308</span><br><span class="line">1309</span><br><span class="line">1310</span><br><span class="line">1311</span><br><span class="line">1312</span><br><span class="line">1313</span><br><span class="line">1314</span><br><span class="line">1315</span><br><span class="line">1316</span><br><span class="line">1317</span><br><span class="line">1318</span><br><span class="line">1319</span><br><span class="line">1320</span><br><span class="line">1321</span><br><span class="line">1322</span><br><span class="line">1323</span><br><span class="line">1324</span><br><span class="line">1325</span><br><span class="line">1326</span><br><span class="line">1327</span><br><span class="line">1328</span><br><span class="line">1329</span><br><span class="line">1330</span><br><span class="line">1331</span><br><span class="line">1332</span><br><span class="line">1333</span><br><span class="line">1334</span><br><span class="line">1335</span><br><span class="line">1336</span><br><span class="line">1337</span><br><span class="line">1338</span><br><span class="line">1339</span><br><span class="line">1340</span><br><span class="line">1341</span><br><span class="line">1342</span><br><span class="line">1343</span><br><span class="line">1344</span><br><span class="line">1345</span><br><span class="line">1346</span><br><span class="line">1347</span><br><span class="line">1348</span><br><span class="line">1349</span><br><span class="line">1350</span><br><span class="line">1351</span><br><span class="line">1352</span><br><span class="line">1353</span><br><span class="line">1354</span><br><span class="line">1355</span><br><span class="line">1356</span><br><span class="line">1357</span><br><span class="line">1358</span><br><span class="line">1359</span><br><span class="line">1360</span><br><span class="line">1361</span><br><span class="line">1362</span><br><span class="line">1363</span><br><span class="line">1364</span><br><span class="line">1365</span><br><span class="line">1366</span><br><span class="line">1367</span><br><span class="line">1368</span><br><span class="line">1369</span><br><span class="line">1370</span><br><span class="line">1371</span><br><span class="line">1372</span><br><span class="line">1373</span><br><span class="line">1374</span><br><span class="line">1375</span><br><span class="line">1376</span><br><span class="line">1377</span><br><span class="line">1378</span><br><span class="line">1379</span><br><span class="line">1380</span><br><span class="line">1381</span><br><span class="line">1382</span><br><span class="line">1383</span><br><span class="line">1384</span><br><span class="line">1385</span><br><span class="line">1386</span><br><span class="line">1387</span><br><span class="line">1388</span><br><span class="line">1389</span><br><span class="line">1390</span><br><span class="line">1391</span><br><span class="line">1392</span><br><span class="line">1393</span><br><span class="line">1394</span><br><span class="line">1395</span><br><span class="line">1396</span><br><span class="line">1397</span><br><span class="line">1398</span><br><span class="line">1399</span><br><span class="line">1400</span><br><span class="line">1401</span><br><span class="line">1402</span><br><span class="line">1403</span><br><span class="line">1404</span><br><span class="line">1405</span><br><span class="line">1406</span><br><span class="line">1407</span><br><span class="line">1408</span><br><span class="line">1409</span><br><span class="line">1410</span><br><span class="line">1411</span><br><span class="line">1412</span><br><span class="line">1413</span><br><span class="line">1414</span><br><span class="line">1415</span><br><span class="line">1416</span><br><span class="line">1417</span><br><span class="line">1418</span><br><span class="line">1419</span><br><span class="line">1420</span><br><span class="line">1421</span><br><span class="line">1422</span><br><span class="line">1423</span><br><span class="line">1424</span><br><span class="line">1425</span><br><span class="line">1426</span><br><span class="line">1427</span><br><span class="line">1428</span><br><span class="line">1429</span><br><span class="line">1430</span><br><span class="line">1431</span><br><span class="line">1432</span><br><span class="line">1433</span><br><span class="line">1434</span><br><span class="line">1435</span><br><span class="line">1436</span><br><span class="line">1437</span><br><span class="line">1438</span><br><span class="line">1439</span><br><span class="line">1440</span><br><span class="line">1441</span><br><span class="line">1442</span><br><span class="line">1443</span><br><span class="line">1444</span><br><span class="line">1445</span><br><span class="line">1446</span><br><span class="line">1447</span><br><span class="line">1448</span><br><span class="line">1449</span><br><span class="line">1450</span><br><span class="line">1451</span><br><span class="line">1452</span><br><span class="line">1453</span><br><span class="line">1454</span><br><span class="line">1455</span><br><span class="line">1456</span><br><span class="line">1457</span><br><span class="line">1458</span><br><span class="line">1459</span><br><span class="line">1460</span><br><span class="line">1461</span><br><span class="line">1462</span><br><span class="line">1463</span><br><span class="line">1464</span><br><span class="line">1465</span><br><span class="line">1466</span><br><span class="line">1467</span><br><span class="line">1468</span><br><span class="line">1469</span><br><span class="line">1470</span><br><span class="line">1471</span><br><span class="line">1472</span><br><span class="line">1473</span><br><span class="line">1474</span><br><span class="line">1475</span><br><span class="line">1476</span><br><span class="line">1477</span><br><span class="line">1478</span><br><span class="line">1479</span><br><span class="line">1480</span><br><span class="line">1481</span><br><span class="line">1482</span><br><span class="line">1483</span><br><span class="line">1484</span><br></pre></td><td class="code"><pre><span class="line">program plcopiler;</span><br><span class="line"><span class="keyword">uses</span> dos;</span><br><span class="line"><span class="keyword">const</span> norw=<span class="number">25</span>;       <span class="comment">&#123; no. of reserved words &#125;</span></span><br><span class="line">      txmax=<span class="number">100</span>;     <span class="comment">&#123; length of identifier table &#125;</span></span><br><span class="line">      bmax=<span class="number">25</span>;       <span class="comment">&#123; length of block inormation table &#125;</span></span><br><span class="line">      arrmax=<span class="number">30</span>;     <span class="comment">&#123; length of array information table &#125;</span></span><br><span class="line">      nmax=<span class="number">6</span>;        <span class="comment">&#123; max. no. of digits in numbers &#125;</span></span><br><span class="line">      al=<span class="number">10</span>;         <span class="comment">&#123; length of identifiers &#125;</span></span><br><span class="line">      amax=<span class="number">2047</span>;     <span class="comment">&#123; maxinum address &#125;</span></span><br><span class="line">      levmax=<span class="number">7</span>;      <span class="comment">&#123; maxinum depth of block nesting &#125;</span></span><br><span class="line">      cxmax=<span class="number">1000</span>;    <span class="comment">&#123; size of code array &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> symbol=</span><br><span class="line">     (nul,ident,intcon,charcon,plus,minus,times,divsym,</span><br><span class="line">      eql,neq,lss,leq,gtr,geq, ofsym,arraysym,programsym,modsym,</span><br><span class="line">      andsym,orsym,notsym,lbrack,rbrack,lparen,rparen,comma,</span><br><span class="line">      semicolon,period,becomes,colon,beginsym,endsym,ifsym,casesym,thensym,</span><br><span class="line">      elsesym,whilesym,repeatsym,dosym,callsym,constsym,typesym,</span><br><span class="line">      varsym,procsym,forsym,untilsym,functionsym,tosym);</span><br><span class="line">     alfa = string[al];</span><br><span class="line">     <span class="keyword">index</span>=-<span class="number">32767</span>..+<span class="number">32767</span>;</span><br><span class="line">     oobject = (konstant,typel,variable,prosedure);</span><br><span class="line">     types=(notyp,ints,chars,bool,arrays);</span><br><span class="line">     symset = <span class="keyword">set</span> <span class="keyword">of</span> symbol;</span><br><span class="line"></span><br><span class="line">     opcod = (lit,lod,ilod,loda,lodt,sto,lodb,cpyb,jmp,jpc,red,wrt,</span><br><span class="line">            cal,retp,endp,udis,opac,entp,ands,ors,nots,imod,mus,<span class="keyword">add</span>,</span><br><span class="line">            sub,mult,idiv,eq,ne,ls,le,gt,ge);  <span class="comment">&#123; opration code &#125;</span></span><br><span class="line">     instruction = <span class="keyword">packed</span> <span class="keyword">record</span></span><br><span class="line">                     f:opcod;</span><br><span class="line">                     l:<span class="number">0</span>..levmax;</span><br><span class="line">                     a:<span class="number">0</span>..amax;</span><br><span class="line">                   <span class="keyword">end</span>;</span><br><span class="line">     item=<span class="keyword">record</span></span><br><span class="line">             typ:types;</span><br><span class="line">             ref:integer</span><br><span class="line">           <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ch:char;           <span class="comment">&#123; last character read &#125;</span></span><br><span class="line">    sym:symbol;        <span class="comment">&#123; last symbol read&#125;</span></span><br><span class="line">    id:alfa;           <span class="comment">&#123; last identifier read  10&#125;</span> </span><br><span class="line">    num:integer;       <span class="comment">&#123; last number read &#125;</span></span><br><span class="line">    cc:integer;        <span class="comment">&#123; character count &#125;</span></span><br><span class="line">    ll:integer;        <span class="comment">&#123; line length &#125;</span></span><br><span class="line">    kk,err:integer;</span><br><span class="line">    line:string[<span class="number">81</span>];</span><br><span class="line">    a:alfa;</span><br><span class="line">    i:integer;</span><br><span class="line">    word:<span class="keyword">array</span>[<span class="number">1</span>..norw] <span class="keyword">of</span> alfa;</span><br><span class="line">    wsym:<span class="keyword">array</span>[<span class="number">1</span>..norw] <span class="keyword">of</span> symbol;</span><br><span class="line">    ssym:<span class="keyword">array</span>[char] <span class="keyword">of</span> symbol;</span><br><span class="line">    mnemonic:<span class="keyword">array</span>[opcod] <span class="keyword">of</span> string[<span class="number">5</span>];</span><br><span class="line">    declbegsys,statbegsys,facbegsys,constbegsys,typebegsys:symset;</span><br><span class="line"></span><br><span class="line">    nametab:<span class="keyword">array</span>[<span class="number">0</span>..txmax] <span class="keyword">of</span>          <span class="comment">&#123; name table &#125;</span></span><br><span class="line">               <span class="keyword">record</span></span><br><span class="line">                 name:alfa;</span><br><span class="line">                 kind:</span><br><span class="line">                 oobject ;</span><br><span class="line">                 typ: types;</span><br><span class="line">                 lev: <span class="number">0</span>..levmax;</span><br><span class="line">                 normal:boolean;</span><br><span class="line">                 ref:<span class="keyword">index</span>;</span><br><span class="line">                 link:<span class="keyword">index</span>;</span><br><span class="line">                 <span class="keyword">case</span> oobject <span class="keyword">of</span></span><br><span class="line">                   variable,prosedure:(adr:integer);</span><br><span class="line">                   konstant         :(val:integer);</span><br><span class="line">                   typel            :(size:integer);</span><br><span class="line"></span><br><span class="line">               <span class="keyword">end</span>;</span><br><span class="line">    tx:  integer;           <span class="comment">&#123; index of nametab&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    atab:<span class="keyword">array</span>[<span class="number">1</span>..amax] <span class="keyword">of</span>             <span class="comment">&#123; array information table &#125;</span></span><br><span class="line">              <span class="keyword">record</span></span><br><span class="line">                inxtyp,eltyp:types;</span><br><span class="line">                elref,low,high,elsize,size:<span class="keyword">index</span>;</span><br><span class="line">              <span class="keyword">end</span>;</span><br><span class="line">    ax:integer;             <span class="comment">&#123;index of atab &#125;</span></span><br><span class="line"></span><br><span class="line">    btab:<span class="keyword">array</span>[<span class="number">0</span>..bmax] <span class="keyword">of</span>            <span class="comment">&#123; block information table &#125;</span></span><br><span class="line">              <span class="keyword">record</span></span><br><span class="line">                last,lastpar,psize,vsize:<span class="keyword">index</span>;</span><br><span class="line">              <span class="keyword">end</span>;</span><br><span class="line">    bx:integer;                 <span class="comment">&#123; index of btab &#125;</span></span><br><span class="line">    display:<span class="keyword">array</span>[<span class="number">0</span>..levmax] <span class="keyword">of</span> integer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    code:<span class="keyword">array</span>[<span class="number">0</span>..cxmax] <span class="keyword">of</span> instruction;</span><br><span class="line">    cx:integer;          <span class="comment">&#123; code allocation index &#125;</span></span><br><span class="line"></span><br><span class="line">    labtab:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100</span>] <span class="keyword">of</span> integer;</span><br><span class="line">    lx:integer;</span><br><span class="line"><span class="comment">&#123;********************************************************&#125;</span></span><br><span class="line">   </span><br><span class="line">   </span><br><span class="line">    sfile:text;         <span class="comment">&#123; source program file &#125;</span></span><br><span class="line">    sfilename:string; <span class="comment">&#123; source program file name &#125;</span></span><br><span class="line">    fcode:file <span class="keyword">of</span> instruction;</span><br><span class="line">    labfile:file <span class="keyword">of</span> integer;</span><br><span class="line"></span><br><span class="line">    listfile :text;</span><br><span class="line">    listfilename:string;</span><br><span class="line">    dir:dirstr;</span><br><span class="line">    name:namestr;</span><br><span class="line">    ext:extstr;</span><br><span class="line"><span class="comment">&#123;*********************************************************&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">initial</span>;</span></span><br><span class="line"> <span class="keyword">begin</span></span><br><span class="line">word[ <span class="number">1</span>]:=<span class="string">'and       '</span>; </span><br><span class="line">  word[ <span class="number">2</span>]:=<span class="string">'array     '</span>;</span><br><span class="line">  word[ <span class="number">3</span>]:=<span class="string">'begin     '</span>; </span><br><span class="line">  word[ <span class="number">4</span>]:=<span class="string">'call      '</span>;</span><br><span class="line">  word[ <span class="number">5</span>]:=<span class="string">'case      '</span>;</span><br><span class="line">  word[ <span class="number">6</span>]:=<span class="string">'const     '</span>; </span><br><span class="line">  word[ <span class="number">7</span>]:=<span class="string">'do        '</span>;</span><br><span class="line">  word[ <span class="number">8</span>]:=<span class="string">'else      '</span>; </span><br><span class="line">  word[ <span class="number">9</span>]:=<span class="string">'end       '</span>;</span><br><span class="line">  word[<span class="number">10</span>]:=<span class="string">'for       '</span>; </span><br><span class="line">  word[<span class="number">11</span>]:=<span class="string">'function  '</span>; </span><br><span class="line">  word[<span class="number">12</span>]:=<span class="string">'if        '</span>; </span><br><span class="line">  word[<span class="number">13</span>]:=<span class="string">'mod       '</span>;</span><br><span class="line">  word[<span class="number">14</span>]:=<span class="string">'not       '</span>; </span><br><span class="line">  word[<span class="number">15</span>]:=<span class="string">'of        '</span>;</span><br><span class="line">  word[<span class="number">16</span>]:=<span class="string">'or        '</span>; </span><br><span class="line">  word[<span class="number">17</span>]:=<span class="string">'procedure '</span>;</span><br><span class="line">  word[<span class="number">18</span>]:=<span class="string">'program   '</span>; </span><br><span class="line">  word[<span class="number">19</span>]:=<span class="string">'repeat    '</span>;</span><br><span class="line">  word[<span class="number">20</span>]:=<span class="string">'then      '</span>;</span><br><span class="line">  word[<span class="number">21</span>]:=<span class="string">'to        '</span>;</span><br><span class="line">  word[<span class="number">22</span>]:=<span class="string">'type      '</span>;</span><br><span class="line">  word[<span class="number">23</span>]:=<span class="string">'until     '</span>;</span><br><span class="line">  word[<span class="number">24</span>]:=<span class="string">'var       '</span>; </span><br><span class="line">  word[<span class="number">25</span>]:=<span class="string">'while     '</span>;</span><br><span class="line">  wsym[ <span class="number">1</span>]:=andsym;       </span><br><span class="line">  wsym[ <span class="number">2</span>]:=arraysym;</span><br><span class="line">  wsym[ <span class="number">3</span>]:=beginsym;     </span><br><span class="line">  wsym[ <span class="number">4</span>]:=callsym;</span><br><span class="line">  wsym[ <span class="number">5</span>]:=casesym;     </span><br><span class="line">  wsym[ <span class="number">6</span>]:=constsym;</span><br><span class="line">  wsym[ <span class="number">7</span>]:=dosym;      </span><br><span class="line">  wsym[ <span class="number">8</span>]:=elsesym;</span><br><span class="line">  wsym[ <span class="number">9</span>]:=endsym;        </span><br><span class="line">  wsym[<span class="number">10</span>]:=forsym;</span><br><span class="line">  wsym[<span class="number">11</span>]:=functionsym;     </span><br><span class="line">  wsym[<span class="number">12</span>]:=ifsym;</span><br><span class="line">  wsym[<span class="number">13</span>]:=modsym;        </span><br><span class="line">  wsym[<span class="number">14</span>]:=notsym;</span><br><span class="line">  wsym[<span class="number">15</span>]:=ofsym;   </span><br><span class="line">  wsym[<span class="number">16</span>]:=orsym;</span><br><span class="line">  wsym[<span class="number">17</span>]:=procsym;      </span><br><span class="line">  wsym[<span class="number">18</span>]:=programsym;</span><br><span class="line">  wsym[<span class="number">19</span>]:=repeatsym;       </span><br><span class="line">  wsym[<span class="number">20</span>]:=thensym;</span><br><span class="line">  wsym[<span class="number">21</span>]:=tosym;</span><br><span class="line">  wsym[<span class="number">22</span>]:=typesym;       </span><br><span class="line">  wsym[<span class="number">23</span>]:=untilsym;  </span><br><span class="line">  wsym[<span class="number">24</span>]:=varsym;       </span><br><span class="line">  wsym[<span class="number">25</span>]:=whilesym;      </span><br><span class="line">  </span><br><span class="line">  ssym[<span class="string">'+'</span>]:=plus;        ssym[<span class="string">'-'</span>]:=minus;</span><br><span class="line">  ssym[<span class="string">'*'</span>]:=times;       ssym[<span class="string">'/'</span>]:=divsym;</span><br><span class="line">  ssym[<span class="string">'['</span>]:=lbrack;      ssym[<span class="string">']'</span>]:=rbrack;</span><br><span class="line">  ssym[<span class="string">'('</span>]:=lparen;      ssym[<span class="string">')'</span>]:=rparen;</span><br><span class="line">  ssym[<span class="string">'='</span>]:=eql;         ssym[<span class="string">','</span>]:=comma;</span><br><span class="line">  ssym[<span class="string">'.'</span>]:=period;</span><br><span class="line">  ssym[<span class="string">'&lt;'</span>]:=lss;         ssym[<span class="string">'&gt;'</span>]:=gtr;</span><br><span class="line">  ssym[<span class="string">';'</span>]:=semicolon;</span><br><span class="line"></span><br><span class="line">  mnemonic[lit]:=<span class="string">'LIT  '</span>;   mnemonic[lod]:=<span class="string">'LOD  '</span>;</span><br><span class="line">  mnemonic[sto]:=<span class="string">'STO  '</span>;   mnemonic[cal]:=<span class="string">'CAL  '</span>;</span><br><span class="line">  mnemonic[jmp]:=<span class="string">'JMP  '</span>;   mnemonic[jpc]:=<span class="string">'JPC  '</span>;</span><br><span class="line">  mnemonic[red]:=<span class="string">'RED  '</span>;   mnemonic[wrt]:=<span class="string">'WRT  '</span>;</span><br><span class="line">  mnemonic[ilod]:=<span class="string">'ILOD  '</span>; mnemonic[loda]:=<span class="string">'LODA '</span>;</span><br><span class="line">  mnemonic[lodt]:=<span class="string">'LODt  '</span>; mnemonic[lodb]:=<span class="string">'LODB '</span>;</span><br><span class="line">  mnemonic[cpyb]:=<span class="string">'COPYB '</span>; mnemonic[endp]:=<span class="string">'ENDP '</span>;</span><br><span class="line">  mnemonic[retp]:=<span class="string">'RETP  '</span>; mnemonic[udis]:=<span class="string">'ADIS '</span>;</span><br><span class="line">  mnemonic[mus]:=<span class="string">'MUS  '</span>;   mnemonic[<span class="keyword">add</span>]:=<span class="string">'ADD '</span>;</span><br><span class="line">  mnemonic[sub]:=<span class="string">'SUB  '</span>;   mnemonic[mult]:=<span class="string">'MULT '</span>;</span><br><span class="line">  mnemonic[idiv]:=<span class="string">'DDIV  '</span>; mnemonic[eq]:=<span class="string">'EQ  '</span>;</span><br><span class="line">  mnemonic[ne]:=<span class="string">'NE '</span>;      mnemonic[ls]:=<span class="string">'LS  '</span>;</span><br><span class="line">  mnemonic[le]:=<span class="string">'LE '</span>;      mnemonic[gt]:=<span class="string">'GT  '</span>;</span><br><span class="line">  mnemonic[ge]:=<span class="string">'GE '</span>;      mnemonic[opac]:=<span class="string">'OPAC '</span>;</span><br><span class="line">  mnemonic[entp]:=<span class="string">'ENTP'</span>;   mnemonic[imod]:=<span class="string">'IMOD '</span>;</span><br><span class="line">  mnemonic[ands]:=<span class="string">'ANDS'</span>;   mnemonic[ors]:=<span class="string">'ORS '</span>;</span><br><span class="line">  mnemonic[nots]:=<span class="string">'NOTS'</span>;</span><br><span class="line"></span><br><span class="line">  declbegsys:=[constsym,varsym,typesym,procsym];   </span><br><span class="line">  statbegsys:=[beginsym,callsym,ifsym,whilesym,casesym,repeatsym,untilsym,forsym];      </span><br><span class="line">  facbegsys :=[ident,intcon,lparen,notsym,charcon];</span><br><span class="line">  typebegsys:=[ident,arraysym];</span><br><span class="line">  constbegsys:=[plus,minus,intcon,charcon,ident];</span><br><span class="line">  err:=<span class="number">0</span>; a[<span class="number">0</span>]:=<span class="string">#10</span>;</span><br><span class="line">  display[<span class="number">0</span>]:=<span class="number">0</span>;   </span><br><span class="line">  cc:=<span class="number">0</span>; cx:=<span class="number">0</span>; ll:=<span class="number">0</span>; ch:=<span class="string">' '</span>; kk:=al; bx:=<span class="number">1</span>;  tx:=-<span class="number">1</span>;</span><br><span class="line">  lx:=<span class="number">0</span></span><br><span class="line"> <span class="keyword">end</span>;   <span class="comment">&#123;init&#125;</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">procedure</span> <span class="title">enterpreid</span>;</span>                              </span><br><span class="line">   <span class="function"><span class="keyword">procedure</span> <span class="title">enter</span><span class="params">(x0:alfa;x1:oobject;</span><br><span class="line">                  x2:types;x3:integer)</span>;</span></span><br><span class="line">   <span class="keyword">begin</span></span><br><span class="line">    tx:=tx+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">with</span> nametab[tx] <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      name:=x0;link:=tx-<span class="number">1</span>;kind:=x1;</span><br><span class="line">      typ:=x2;ref:=<span class="number">0</span>;normal:=<span class="keyword">true</span>;</span><br><span class="line">      lev:=<span class="number">0</span>;</span><br><span class="line">      <span class="keyword">case</span> kind <span class="keyword">of</span></span><br><span class="line">        variable,prosedure: adr:=x3;       </span><br><span class="line">        konstant:           val:=x3;                </span><br><span class="line">        typel:              size:=x3                    </span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">   enter(<span class="string">'          '</span>,variable,notyp,<span class="number">0</span>);       <span class="comment">&#123; sentinel &#125;</span></span><br><span class="line">   enter(<span class="string">'char      '</span>,typel, chars,<span class="number">1</span>);    </span><br><span class="line">   enter(<span class="string">'integer   '</span>,typel,ints,  <span class="number">1</span>);</span><br><span class="line">   enter(<span class="string">'boolean   '</span>,typel,bool,  <span class="number">1</span>);</span><br><span class="line">   enter(<span class="string">'false     '</span>,konstant,bool,  <span class="number">0</span>);</span><br><span class="line">   enter(<span class="string">'true      '</span>,konstant,bool,  <span class="number">1</span>);</span><br><span class="line">   enter(<span class="string">'read      '</span>,prosedure,notyp,<span class="number">1</span>);</span><br><span class="line">   enter(<span class="string">'write     '</span>,prosedure,notyp,<span class="number">2</span>);</span><br><span class="line">   btab[<span class="number">0</span>].last:=tx; btab[<span class="number">0</span>].lastpar:=<span class="number">1</span>;</span><br><span class="line">   btab[<span class="number">0</span>].psize:=<span class="number">0</span>; btab[<span class="number">0</span>].vsize:=<span class="number">0</span></span><br><span class="line">  <span class="keyword">end</span>;       <span class="comment">&#123;enterprid&#125;</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">procedure</span> <span class="title">error</span><span class="params">(n:integer)</span>;</span></span><br><span class="line">   <span class="keyword">begin</span> writeln(listfile,<span class="string">'****'</span>,<span class="string">' '</span>:cc-<span class="number">1</span>,<span class="string">'^'</span>,n:<span class="number">2</span>);</span><br><span class="line">        err:=err+<span class="number">1</span></span><br><span class="line">   <span class="keyword">end</span>; <span class="comment">&#123; error &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">procedure</span> <span class="title">getsym</span>;</span></span><br><span class="line">    label <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> i,k,j:integer;</span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">getch</span>;</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> cc=ll <span class="keyword">then</span>   <span class="comment">&#123; get character to end of line &#125;</span></span><br><span class="line">      <span class="comment">&#123; read next line &#125;</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> eof(sfile) <span class="keyword">then</span>  </span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">            writeln(<span class="string">'program incomplete'</span>);</span><br><span class="line">            close(sfile);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">        ll:=<span class="number">0</span>; cc:=<span class="number">0</span>; <span class="keyword">write</span>(listfile,cx:<span class="number">4</span>,<span class="string">' '</span>);    <span class="comment">&#123;print code address &#125;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> eoln(sfile) <span class="keyword">do</span></span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">            ll:=ll+<span class="number">1</span>; <span class="keyword">read</span>(sfile,ch); <span class="keyword">write</span>(listfile,ch);</span><br><span class="line">            line[ll]:=ch</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">        writeln(listfile); readln(sfile);</span><br><span class="line">        ll:=ll+<span class="number">1</span>; line[ll]:=<span class="string">' '</span>  <span class="comment">&#123;process end-line&#125;</span>           </span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">      cc:=cc+<span class="number">1</span>; ch:=line[cc]           </span><br><span class="line">    <span class="keyword">end</span>;  <span class="comment">&#123; getch &#125;</span></span><br><span class="line">  <span class="keyword">begin</span>  <span class="comment">&#123;getsym&#125;</span></span><br><span class="line"> <span class="number">1</span>:   <span class="keyword">while</span> ch=<span class="string">' '</span> <span class="keyword">do</span> getch;</span><br><span class="line">    <span class="keyword">case</span> ch <span class="keyword">of</span></span><br><span class="line">    <span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>,<span class="string">'e'</span>,<span class="string">'f'</span>,<span class="string">'g'</span>,<span class="string">'h'</span>,<span class="string">'i'</span>,<span class="string">'j'</span>,<span class="string">'k'</span>,<span class="string">'l'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,</span><br><span class="line">    <span class="string">'o'</span>,<span class="string">'p'</span>,<span class="string">'q'</span>,<span class="string">'r'</span>,<span class="string">'s'</span>,<span class="string">'t'</span>,<span class="string">'u'</span>,<span class="string">'v'</span>,<span class="string">'w'</span>,<span class="string">'x'</span>,<span class="string">'y'</span>,<span class="string">'z'</span>:</span><br><span class="line">    <span class="keyword">begin</span>   <span class="comment">&#123; identifier or reserved（关键字） word &#125;</span></span><br><span class="line">      k:=<span class="number">0</span>;</span><br><span class="line">      <span class="keyword">repeat</span></span><br><span class="line">        <span class="keyword">if</span> k&lt;al <span class="keyword">then</span></span><br><span class="line">          <span class="keyword">begin</span> k:=k+<span class="number">1</span>; a[k]:=ch  <span class="keyword">end</span>;</span><br><span class="line">        getch</span><br><span class="line">      <span class="keyword">until</span> <span class="keyword">not</span> (ch <span class="keyword">in</span> [<span class="string">'a'</span>..<span class="string">'z'</span>,<span class="string">'0'</span>..<span class="string">'9'</span>]);</span><br><span class="line">      <span class="keyword">if</span> k&gt;=kk <span class="keyword">then</span> kk:=k      <span class="comment">&#123; kk: last identifier length &#125;</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">repeat</span></span><br><span class="line">          a[kk]:=<span class="string">' '</span>; kk:=kk-<span class="number">1</span></span><br><span class="line">        <span class="keyword">until</span> kk=k;</span><br><span class="line">      id:=a; i:=<span class="number">1</span>; j:=norw; <span class="comment">&#123; binary search reserved word table &#125;</span></span><br><span class="line">      <span class="keyword">repeat</span></span><br><span class="line">        k:=(i+j) <span class="keyword">div</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> id&lt;=word[k] <span class="keyword">then</span> j:=k-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> id&gt;=word[k] <span class="keyword">then</span> i:=k+<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">until</span> i&gt;j;</span><br><span class="line">      <span class="keyword">if</span> i-<span class="number">1</span>&gt;j <span class="keyword">then</span> sym:=wsym[k]</span><br><span class="line">      <span class="keyword">else</span> sym:=ident</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="string">'&#123;'</span> :</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">repeat</span></span><br><span class="line">         getch</span><br><span class="line">      <span class="keyword">until</span> ch = <span class="string">'&#125;'</span>;</span><br><span class="line">       getch;</span><br><span class="line">      goto <span class="number">1</span></span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line">    <span class="string">'0'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>:</span><br><span class="line">      <span class="keyword">begin</span> <span class="comment">&#123; number &#125;</span></span><br><span class="line">        k:=<span class="number">0</span>; num:=<span class="number">0</span>; sym:=intcon;</span><br><span class="line">        <span class="keyword">repeat</span></span><br><span class="line">          num:=<span class="number">10</span>*num+(ord(ch)-ord(<span class="string">'0'</span>));</span><br><span class="line">          k:=k+<span class="number">1</span>; getch</span><br><span class="line">        <span class="keyword">until</span> <span class="keyword">not</span> (ch <span class="keyword">in</span> [<span class="string">'0'</span>..<span class="string">'9'</span>]);</span><br><span class="line">        <span class="keyword">if</span> k&gt;nmax <span class="keyword">then</span> error(<span class="number">47</span>)</span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">      </span><br><span class="line">   <span class="string">':'</span>:</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          getch;</span><br><span class="line">          <span class="keyword">if</span> ch=<span class="string">'='</span> <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">begin</span> sym:=becomes; getch <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">else</span> sym:=colon</span><br><span class="line">        <span class="keyword">end</span> ;</span><br><span class="line">   <span class="string">'&lt;'</span> :</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            getch;</span><br><span class="line">            <span class="keyword">if</span> ch=<span class="string">'='</span> <span class="keyword">then</span></span><br><span class="line">              <span class="keyword">begin</span> sym:=leq; getch <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              <span class="keyword">if</span> ch=<span class="string">'&gt;'</span> <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">begin</span> sym:=neq; getch <span class="keyword">end</span></span><br><span class="line">              <span class="keyword">else</span> sym:=lss</span><br><span class="line">          <span class="keyword">end</span> ;</span><br><span class="line">   <span class="string">'&gt;'</span> :</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">              getch;</span><br><span class="line">              <span class="keyword">if</span> ch=<span class="string">'='</span> <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">begin</span> sym:=geq; getch <span class="keyword">end</span></span><br><span class="line">              <span class="keyword">else</span> sym:=gtr</span><br><span class="line">        <span class="keyword">end</span>  ;</span><br><span class="line">   <span class="string">'.'</span> :</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          getch;</span><br><span class="line">          <span class="keyword">if</span> ch=<span class="string">'.'</span></span><br><span class="line">            <span class="keyword">then</span>  <span class="keyword">begin</span></span><br><span class="line">                   sym:=colon;getch</span><br><span class="line">                  <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span>   sym:=period</span><br><span class="line">         <span class="keyword">end</span>;</span><br><span class="line">   <span class="string">''''</span>  :</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          getch;</span><br><span class="line">          sym:=charcon;num:=ord(ch);</span><br><span class="line">          getch;</span><br><span class="line">          <span class="keyword">if</span> ch=<span class="string">''''</span> <span class="keyword">then</span> getch</span><br><span class="line">                     <span class="keyword">else</span> error(<span class="number">48</span>)</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">   <span class="string">'+'</span>,<span class="string">'-'</span>,<span class="string">'*'</span>,<span class="string">'/'</span>,<span class="string">'('</span>,<span class="string">')'</span>,<span class="string">'='</span>,<span class="string">'['</span>,<span class="string">']'</span>,<span class="string">';'</span>,<span class="string">','</span>:</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          sym:=ssym[ch];getch</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         error(<span class="number">0</span>); getch;</span><br><span class="line">         goto <span class="number">1</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>  <span class="comment">&#123; case &#125;</span></span><br><span class="line">  <span class="keyword">end</span>;  <span class="comment">&#123; getsym &#125;</span>    </span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">procedure</span> <span class="title">enterarray</span> <span class="params">(tp:types ; l,h:integer)</span>;</span> </span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> l&gt;h <span class="keyword">then</span> error(<span class="number">14</span>);</span><br><span class="line">    <span class="keyword">if</span> ax=amax <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        error(<span class="number">2</span>);</span><br><span class="line">        writeln(<span class="string">'too many arrays in program '</span>);</span><br><span class="line">        close(sfile);</span><br><span class="line">        close(listfile);</span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        ax:=ax+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">with</span> atab[ax] <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          inxtyp:=tp; low:=l; high:=h</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span>;  <span class="comment">&#123; enterarray &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">procedure</span> <span class="title">enterblock</span>;</span>   </span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> bx=bmax  <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        error(<span class="number">3</span>);</span><br><span class="line">        writeln(<span class="string">'too many procedure in program '</span>);</span><br><span class="line">        close(sfile);</span><br><span class="line">        close(listfile);</span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">      bx:=bx+<span class="number">1</span>; btab[bx].last:=<span class="number">0</span>; btab[bx].lastpar:=<span class="number">0</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span>;   <span class="comment">&#123; enterblock &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">procedure</span> <span class="title">gen</span><span class="params">(x:opcod; y,z:integer)</span>;</span>  <span class="comment">&#123;产生代码程序gen&#125;</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> cx&gt;cxmax <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        error(<span class="number">49</span>);</span><br><span class="line">        writeln(<span class="string">'program too long'</span>);</span><br><span class="line">        close(sfile);</span><br><span class="line">        close(listfile);</span><br><span class="line">        <span class="keyword">exit</span></span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">with</span> code[cx] <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        f:=x; l:=y; a:=z    </span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">     cx:=cx+<span class="number">1</span></span><br><span class="line">  <span class="keyword">end</span>;  <span class="comment">&#123; gen &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">procedure</span> <span class="title">test</span><span class="params">(s1,s2:symset;n:integer)</span>;</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (sym <span class="keyword">in</span> s1) <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        error(n); s1:=s1+s2;</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> (sym <span class="keyword">in</span> s1) <span class="keyword">do</span> getsym</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span>;  <span class="comment">&#123; test &#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">procedure</span> <span class="title">block</span><span class="params">( fsys:symset;level:integer)</span>;</span></span><br><span class="line">  <span class="keyword">type</span></span><br><span class="line">    constrec=<span class="keyword">record</span>   </span><br><span class="line">            tp:types;</span><br><span class="line">            i:integer</span><br><span class="line">           <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">var</span> dx:integer;  <span class="comment">&#123; data allocation index &#125;</span></span><br><span class="line">      tx0:integer; <span class="comment">&#123; initial table index &#125;</span></span><br><span class="line">      cx0:integer; <span class="comment">&#123; initial code  index &#125;</span></span><br><span class="line">      prt,prb:integer;</span><br><span class="line">  <span class="function"><span class="keyword">procedure</span> <span class="title">enter</span><span class="params">( k:oobject)</span>;</span>         </span><br><span class="line">   <span class="keyword">var</span> j,l:integer;</span><br><span class="line">   <span class="keyword">begin</span></span><br><span class="line">     <span class="keyword">if</span> tx=txmax</span><br><span class="line">      <span class="keyword">then</span>  <span class="keyword">begin</span></span><br><span class="line">              error(<span class="number">1</span>);</span><br><span class="line">              writeln(<span class="string">'program too long'</span>);</span><br><span class="line">              close(sfile);</span><br><span class="line">              close(listfile);</span><br><span class="line">              <span class="keyword">exit</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">else</span>  <span class="keyword">begin</span></span><br><span class="line">        nametab[<span class="number">0</span>].name:=id;</span><br><span class="line">        j:=btab[display[level]].last; l:=j;</span><br><span class="line">        <span class="keyword">while</span> nametab[j].name&lt;&gt;id <span class="keyword">do</span> j:=nametab[j].link; </span><br><span class="line">        <span class="keyword">if</span> j&lt;&gt;<span class="number">0</span>     </span><br><span class="line">        <span class="keyword">then</span> error(l)</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span>     </span><br><span class="line">          tx:=tx+<span class="number">1</span>;</span><br><span class="line">          <span class="keyword">with</span> nametab[tx] <span class="keyword">do</span></span><br><span class="line">          <span class="keyword">begin</span>             </span><br><span class="line">            name:=id; link:=l;</span><br><span class="line">            kind:=k;   typ:=notyp;    ref:=<span class="number">0</span>;  </span><br><span class="line">            lev:=level;  normal:=<span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">case</span> kind <span class="keyword">of</span>                                            </span><br><span class="line">              variable,prosedure: adr:=<span class="number">0</span>;</span><br><span class="line">              konstant:           val:=<span class="number">0</span>;</span><br><span class="line">              typel:              size:=<span class="number">0</span></span><br><span class="line">            <span class="keyword">end</span>  <span class="comment">&#123; initial value &#125;</span></span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">          btab[display[level]].last:=tx </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">end</span>;   <span class="comment">&#123; enter &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">position</span><span class="params">(id:alfa)</span>:</span>integer;    </span><br><span class="line">    <span class="keyword">var</span> i,j:integer;</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      nametab[<span class="number">0</span>].name:=id; j:=level;</span><br><span class="line">      <span class="keyword">repeat</span></span><br><span class="line">        i:=btab[display[j]].last;</span><br><span class="line">        <span class="keyword">while</span> nametab[i].name&lt;&gt;id <span class="keyword">do</span></span><br><span class="line">          i:=nametab[i].link;</span><br><span class="line">        j:=j-<span class="number">1</span></span><br><span class="line">      <span class="keyword">until</span> (j&lt;<span class="number">0</span>) <span class="keyword">or</span> (i&lt;&gt;<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">if</span> (i=<span class="number">0</span>) <span class="keyword">then</span> error(<span class="number">10</span>);</span><br><span class="line">      position:=i</span><br><span class="line">    <span class="keyword">end</span>;  <span class="comment">&#123; position &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">constant</span><span class="params">(fsys:symset; <span class="keyword">var</span> c:constrec)</span>;</span>   </span><br><span class="line">      <span class="keyword">var</span> x,sign:integer;</span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">      c.tp:=notyp; c.i:=<span class="number">0</span>;</span><br><span class="line">      test(constbegsys,fsys,<span class="number">50</span>);</span><br><span class="line">      <span class="keyword">if</span> sym <span class="keyword">in</span> constbegsys</span><br><span class="line">      <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span>   sym=charcon</span><br><span class="line">         <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">           c.tp:=chars; c.i:=num;</span><br><span class="line">           getsym</span><br><span class="line">         <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">           <span class="keyword">begin</span></span><br><span class="line">             sign:=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> sym <span class="keyword">in</span> [plus,minus]</span><br><span class="line">            <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">              <span class="keyword">if</span> sym=minus <span class="keyword">then</span> sign:=-<span class="number">1</span>;</span><br><span class="line">              getsym</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            <span class="keyword">if</span> sym=ident</span><br><span class="line">            <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">              x:=position(id);</span><br><span class="line">              <span class="keyword">if</span> x&lt;&gt;<span class="number">0</span></span><br><span class="line">              <span class="keyword">then</span> <span class="keyword">if</span> nametab[x].kind&lt;&gt;konstant</span><br><span class="line">                  <span class="keyword">then</span> error(<span class="number">12</span>)</span><br><span class="line">                  <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                          c.tp:=nametab[x].typ;</span><br><span class="line">                          c.i:=sign*nametab[x].val</span><br><span class="line">                  <span class="keyword">end</span>;</span><br><span class="line">              getsym</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> sym=intcon</span><br><span class="line">               <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">                      c.tp:=ints; c.i:=sign*num;</span><br><span class="line">                      getsym</span><br><span class="line">               <span class="keyword">end</span></span><br><span class="line">       <span class="keyword">end</span>;</span><br><span class="line">       test(fsys,[],<span class="number">6</span>)</span><br><span class="line">     <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span>;    <span class="comment">&#123; constant &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">typ</span><span class="params">(fsys:symset;<span class="keyword">var</span> tp:types; <span class="keyword">var</span> rf,sz:integer)</span>;</span></span><br><span class="line"><span class="keyword">var</span>  eltp:types;</span><br><span class="line">     elrf,x:integer;</span><br><span class="line">     elsz,offset,t0,t1:integer;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">arraytyp</span><span class="params">(<span class="keyword">var</span> aref,arsz:integer)</span>;</span> </span><br><span class="line"><span class="keyword">var</span>  eltp:types;</span><br><span class="line">     low,high:constrec;</span><br><span class="line">     elrf,elsz:integer;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  constant([colon,rbrack,rparen,ofsym]+fsys,low);</span><br><span class="line">  <span class="keyword">if</span> (low.tp&lt;&gt;ints)  <span class="keyword">and</span> (low.tp&lt;&gt;chars)</span><br><span class="line">  <span class="keyword">then</span>  error(<span class="number">50</span>);</span><br><span class="line">  <span class="keyword">if</span> sym=colon <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">38</span>);</span><br><span class="line">  constant([rbrack,comma,rparen,ofsym]+fsys,high);</span><br><span class="line">  <span class="keyword">if</span> high.tp&lt;&gt;low.tp</span><br><span class="line">  <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">    error(<span class="number">40</span>); high.i:=low.i;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  enterarray(low.tp,low.i,high.i);</span><br><span class="line">  aref:=ax;</span><br><span class="line">  <span class="keyword">if</span> sym=comma</span><br><span class="line">  <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">    getsym;</span><br><span class="line">    eltp:=arrays;</span><br><span class="line">    arraytyp(elrf,elsz)</span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> sym=rbrack</span><br><span class="line">    <span class="keyword">then</span> getsym</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">      error(<span class="number">28</span>);</span><br><span class="line">      <span class="keyword">if</span> sym=rparen <span class="keyword">then</span> getsym</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">if</span> sym=ofsym <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">17</span>);</span><br><span class="line">    typ(fsys,eltp,elrf,elsz)</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">with</span> atab[aref] <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    arsz:=(high-low+<span class="number">1</span>)*elsz; size:=arsz;</span><br><span class="line">    eltyp:=eltp; elref:=elrf; elsize:=elsz</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;   <span class="comment">&#123; arraytyp &#125;</span></span><br><span class="line"><span class="keyword">begin</span>  <span class="comment">&#123; typ &#125;</span></span><br><span class="line">  tp:=notyp; rf:=<span class="number">0</span>; sz:=<span class="number">0</span>;</span><br><span class="line">  test(typebegsys,fsys,<span class="number">10</span>);</span><br><span class="line">  <span class="keyword">if</span> sym <span class="keyword">in</span> typebegsys</span><br><span class="line">  <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> sym=ident</span><br><span class="line">    <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">       x:=position(id);</span><br><span class="line">       <span class="keyword">if</span> x&lt;&gt;<span class="number">0</span></span><br><span class="line">       <span class="keyword">then</span> <span class="keyword">with</span> nametab[x] <span class="keyword">do</span></span><br><span class="line">              <span class="keyword">if</span> kind&lt;&gt;typel</span><br><span class="line">              <span class="keyword">then</span> error(<span class="number">19</span>)</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                tp:=typ;rf:=ref;sz:=size;</span><br><span class="line">                <span class="keyword">if</span> tp=notyp <span class="keyword">then</span> error(<span class="number">18</span>);</span><br><span class="line">              <span class="keyword">end</span>;</span><br><span class="line">         getsym;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> sym=arraysym</span><br><span class="line">                <span class="keyword">then</span>  <span class="keyword">begin</span></span><br><span class="line">                  getsym;</span><br><span class="line">                  <span class="keyword">if</span> sym=lbrack</span><br><span class="line">                  <span class="keyword">then</span> getsym</span><br><span class="line">                  <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    error(<span class="number">16</span>);</span><br><span class="line">                    <span class="keyword">if</span> sym=lparen</span><br><span class="line">                    <span class="keyword">then</span> getsym</span><br><span class="line">                  <span class="keyword">end</span>;</span><br><span class="line">                  tp:=arrays;</span><br><span class="line">                  arraytyp(rf,sz)</span><br><span class="line">                <span class="keyword">end</span> ;</span><br><span class="line">         test(fsys,[],<span class="number">13</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span>;       <span class="comment">&#123;typ&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">paramenterlist</span>;</span>   <span class="comment">&#123;formal parameter list&#125;</span></span><br><span class="line">    <span class="keyword">var</span></span><br><span class="line">      tp:types;</span><br><span class="line">      valpar:boolean;</span><br><span class="line">      rf,sz,x,t0:integer;</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      getsym;</span><br><span class="line">      tp:=notyp;rf:=<span class="number">0</span>;sz:=<span class="number">0</span>;</span><br><span class="line">      test([ident,varsym],fsys+[rparen],<span class="number">7</span>);</span><br><span class="line">      <span class="keyword">while</span> sym <span class="keyword">in</span> [ident,varsym] <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> sym &lt;&gt; varsym</span><br><span class="line">          <span class="keyword">then</span> valpar:=<span class="keyword">true</span></span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            getsym;</span><br><span class="line">            valpar:=<span class="keyword">false</span></span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">          t0:=tx;</span><br><span class="line">          <span class="keyword">if</span> sym=ident</span><br><span class="line">          <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            enter(variable);</span><br><span class="line">            getsym</span><br><span class="line">          <span class="keyword">end</span>  <span class="keyword">else</span> error(<span class="number">22</span>);</span><br><span class="line">          <span class="keyword">while</span> sym=comma <span class="keyword">do</span></span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">            getsym;</span><br><span class="line">            <span class="keyword">if</span> sym=ident</span><br><span class="line">            <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">              enter(variable);</span><br><span class="line">              getsym</span><br><span class="line">            <span class="keyword">end</span>  <span class="keyword">else</span> error(<span class="number">22</span>);</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">          <span class="keyword">if</span> sym=colon</span><br><span class="line">          <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            getsym;</span><br><span class="line">            <span class="keyword">if</span> sym &lt;&gt; ident</span><br><span class="line">            <span class="keyword">then</span> error(<span class="number">22</span>)</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">              x :=position(id); getsym;</span><br><span class="line">              <span class="keyword">if</span> x&lt;&gt;<span class="number">0</span></span><br><span class="line">              <span class="keyword">then</span> <span class="keyword">with</span> nametab[x] <span class="keyword">do</span></span><br><span class="line">                <span class="keyword">if</span> kind &lt;&gt; typel</span><br><span class="line">                <span class="keyword">then</span> error(<span class="number">19</span>)</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                  tp:= typ; rf:=ref;</span><br><span class="line">                  <span class="keyword">if</span> valpar <span class="keyword">then</span> sz:=size <span class="keyword">else</span> sz:=<span class="number">1</span></span><br><span class="line">                <span class="keyword">end</span>;</span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">            test ([semicolon,rparen],[comma,ident]+fsys,<span class="number">14</span>)</span><br><span class="line">          <span class="keyword">end</span> <span class="keyword">else</span> error(<span class="number">24</span>);</span><br><span class="line">          <span class="keyword">while</span> t0 &lt; tx <span class="keyword">do</span></span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">            t0 :=t0+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">with</span> nametab[t0] <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">              typ :=tp;ref :=rf;</span><br><span class="line">              adr :=dx;lev :=level;</span><br><span class="line">              normal :=valpar;</span><br><span class="line">              dx :=dx+sz</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">          <span class="keyword">if</span> sym &lt;&gt; rparen</span><br><span class="line">          <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> sym=semicolon</span><br><span class="line">            <span class="keyword">then</span> getsym</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">              error(<span class="number">23</span>);</span><br><span class="line">            <span class="keyword">if</span> sym=comma <span class="keyword">then</span> getsym</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">          test([ident,varsym],[rparen]+fsys,<span class="number">13</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span> <span class="comment">&#123;while&#125;</span>;</span><br><span class="line">      <span class="keyword">if</span> sym=rparen</span><br><span class="line">       <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">         getsym;</span><br><span class="line">         test([semicolon],fsys,<span class="number">13</span>)</span><br><span class="line">       <span class="keyword">end</span> <span class="keyword">else</span> error(<span class="number">25</span>)</span><br><span class="line">    <span class="keyword">end</span> <span class="comment">&#123;parameterlist&#125;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">constdeclaration</span>;</span>  </span><br><span class="line">    <span class="keyword">var</span> c:constrec;</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> sym=ident <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          enter(konstant);</span><br><span class="line">          getsym;</span><br><span class="line">          <span class="keyword">if</span> sym = eql</span><br><span class="line">            <span class="keyword">then</span> getsym</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              <span class="keyword">begin</span></span><br><span class="line">                error(<span class="number">26</span>);</span><br><span class="line">                <span class="keyword">if</span> sym=becomes <span class="keyword">then</span> getsym</span><br><span class="line">              <span class="keyword">end</span>;</span><br><span class="line">          constant([semicolon,comma,ident]+fsys,c);</span><br><span class="line">          nametab[tx].typ:=c.tp;</span><br><span class="line">          nametab[tx].ref:=<span class="number">0</span>;</span><br><span class="line">          nametab[tx].val:=c.i;</span><br><span class="line">          <span class="keyword">if</span> sym=semicolon <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">23</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> error(<span class="number">22</span>);</span><br><span class="line">      test(fsys+[ident],[],<span class="number">13</span>)</span><br><span class="line">    <span class="keyword">end</span>;   <span class="comment">&#123; constdeclaration &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">typedeclaration</span>;</span>  </span><br><span class="line">    <span class="keyword">var</span></span><br><span class="line">      tp:types;</span><br><span class="line">      rf,sz,t1:integer;</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> sym=ident <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          enter(typel);</span><br><span class="line">          t1:=tx;</span><br><span class="line">          getsym;</span><br><span class="line">          <span class="keyword">if</span> sym = eql <span class="keyword">then</span>  getsym</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">              error(<span class="number">26</span>);</span><br><span class="line">              <span class="keyword">if</span> sym=becomes <span class="keyword">then</span>   getsym;</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">         typ ([semicolon,comma,ident]+fsys,tp,rf,sz);</span><br><span class="line">         nametab[tx].typ:=tp;</span><br><span class="line">         nametab[tx].ref:=rf;</span><br><span class="line">         nametab[tx].size:=sz;</span><br><span class="line">         <span class="keyword">if</span> sym=semicolon <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">23</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> error(<span class="number">22</span>);</span><br><span class="line">      test(fsys+[ident],[],<span class="number">13</span>)</span><br><span class="line">    <span class="keyword">end</span>;   <span class="comment">&#123; typedeclaration &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">vardeclaration</span>;</span>  </span><br><span class="line">    <span class="keyword">var</span> tp:types;</span><br><span class="line">        t0,t1,rf,sz:integer;</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> sym=ident <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          t0:=tx;</span><br><span class="line">          enter(variable); getsym;</span><br><span class="line">          <span class="keyword">while</span> sym = comma <span class="keyword">do</span></span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">            getsym;</span><br><span class="line">            <span class="keyword">if</span> sym =ident</span><br><span class="line">            <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">              enter(variable);getsym;</span><br><span class="line">            <span class="keyword">end</span> <span class="keyword">else</span> error(<span class="number">22</span>);</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">          <span class="keyword">if</span> sym = colon <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">24</span>);</span><br><span class="line">          t1:=tx;</span><br><span class="line">          typ ([semicolon,comma,ident]+fsys,tp,rf,sz);</span><br><span class="line">          <span class="keyword">while</span> t0 &lt; t1 <span class="keyword">do</span></span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">            t0:=t0+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">with</span> nametab[t0] <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">              typ:=tp;  ref:=rf;</span><br><span class="line">              lev:=level; adr:=dx;</span><br><span class="line">              normal:=<span class="keyword">true</span>;</span><br><span class="line">              dx:=dx+sz</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">          <span class="keyword">if</span> sym=semicolon <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">23</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> error(<span class="number">22</span>);</span><br><span class="line">      test(fsys+[ident],[],<span class="number">13</span>)</span><br><span class="line">    <span class="keyword">end</span>;  <span class="comment">&#123; vardeclaration &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">procdeclaration</span>;</span>  </span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      getsym;</span><br><span class="line">      <span class="keyword">if</span> sym &lt;&gt; ident</span><br><span class="line">      <span class="keyword">then</span>  <span class="keyword">begin</span></span><br><span class="line">        error(<span class="number">22</span>); id:=<span class="string">' '</span></span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">      enter(prosedure);  </span><br><span class="line">      nametab[tx].normal:=<span class="keyword">true</span>;</span><br><span class="line">      getsym;</span><br><span class="line">      <span class="keyword">block</span>([semicolon]+fsys,level+<span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> sym = semicolon <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">23</span>);</span><br><span class="line">    <span class="keyword">end</span>;    <span class="comment">&#123;procdeclaration&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">listcode</span>;</span></span><br><span class="line">    <span class="keyword">var</span> i:integer;</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">for</span> i:=cx0 <span class="keyword">to</span> cx-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">with</span> code[i] <span class="keyword">do</span></span><br><span class="line">          writeln(listfile,i:<span class="number">4</span>,mnemonic[f]:<span class="number">7</span>,l:<span class="number">3</span>,a:<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">end</span>;  <span class="comment">&#123; listcode &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">statement</span><span class="params">(fsys:symset)</span>;</span></span><br><span class="line">    <span class="keyword">var</span> i,cx1,cx2,cx3:integer;</span><br><span class="line">        x:item;</span><br><span class="line">      <span class="function"><span class="keyword">procedure</span> <span class="title">arrayelement</span><span class="params">(fsys:symset;<span class="keyword">var</span> x:item)</span>;</span> <span class="keyword">forward</span>;</span><br><span class="line">      <span class="function"><span class="keyword">procedure</span> <span class="title">expression</span><span class="params">(fsys:symset;<span class="keyword">var</span> x: item)</span>;</span></span><br><span class="line">      <span class="keyword">var</span> relop:symbol;</span><br><span class="line">          y:item;</span><br><span class="line">        <span class="function"><span class="keyword">procedure</span> <span class="title">simpleexpression</span><span class="params">(fsys:symset;<span class="keyword">var</span> x:item)</span>;</span></span><br><span class="line">          <span class="keyword">var</span> addop:symbol;</span><br><span class="line">              y:item;</span><br><span class="line">          <span class="function"><span class="keyword">procedure</span> <span class="title">term</span><span class="params">(fsys:symset;<span class="keyword">var</span> x: item)</span>;</span></span><br><span class="line">          <span class="keyword">var</span> mulop:symbol;</span><br><span class="line">              y:item;</span><br><span class="line">            <span class="function"><span class="keyword">procedure</span> <span class="title">factor</span><span class="params">(fsys:symset;<span class="keyword">var</span> x:item)</span>;</span></span><br><span class="line">            <span class="keyword">var</span> i:integer;</span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">            x.typ:=notyp;</span><br><span class="line">            x.ref:=<span class="number">0</span>;</span><br><span class="line">            test(facbegsys,fsys,<span class="number">13</span>);</span><br><span class="line">            <span class="keyword">if</span> sym <span class="keyword">in</span> facbegsys <span class="keyword">then</span>    <span class="comment">&#123; facbegsys :=[ident,intcon,lparen,notsym,charcon];&#125;</span></span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">              <span class="keyword">case</span> sym <span class="keyword">of</span></span><br><span class="line">              ident :</span><br><span class="line">              <span class="keyword">begin</span></span><br><span class="line">                i:=position(id);</span><br><span class="line">                getsym;</span><br><span class="line">                <span class="keyword">if</span> i=<span class="number">0</span> <span class="keyword">then</span> error(<span class="number">10</span>)</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                  <span class="keyword">with</span> nametab[i] <span class="keyword">do</span></span><br><span class="line">                    <span class="keyword">case</span> kind <span class="keyword">of</span></span><br><span class="line">                      konstant: <span class="keyword">begin</span></span><br><span class="line">                                  x.typ:=typ;</span><br><span class="line">                                  x.ref:=<span class="number">0</span>;</span><br><span class="line">                                  gen(lit,<span class="number">0</span>,val);</span><br><span class="line">                                <span class="keyword">end</span>;</span><br><span class="line">                      variable:</span><br><span class="line">                        <span class="keyword">begin</span></span><br><span class="line">                          x.typ:=typ;</span><br><span class="line">                          x.ref:=ref;</span><br><span class="line">                          <span class="keyword">if</span> (typ = ints) <span class="keyword">or</span> (typ = bool) <span class="keyword">or</span>(typ=chars)</span><br><span class="line"></span><br><span class="line">                          <span class="keyword">then</span>  <span class="keyword">if</span> normal  <span class="keyword">then</span> gen(lod,lev,adr)</span><br><span class="line">                                           <span class="keyword">else</span> gen(ilod,lev,adr)</span><br><span class="line">                          <span class="keyword">else</span>  <span class="keyword">if</span> typ=arrays <span class="keyword">then</span></span><br><span class="line">                               <span class="keyword">begin</span></span><br><span class="line">                                 <span class="keyword">if</span> normal <span class="keyword">then</span> gen(loda,lev,adr)</span><br><span class="line">                                           <span class="keyword">else</span> gen(lod,lev,adr);</span><br><span class="line">                                 <span class="keyword">if</span> sym = lbrack</span><br><span class="line">                                   <span class="keyword">then</span> arrayelement(fsys,x);</span><br><span class="line">                                 <span class="keyword">if</span> x.typ &lt;&gt; arrays</span><br><span class="line">                                   <span class="keyword">then</span> gen(lodt,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                               <span class="keyword">end</span></span><br><span class="line">                        <span class="keyword">end</span>;</span><br><span class="line">                      prosedure,typel:error(<span class="number">41</span>)</span><br><span class="line">                    <span class="keyword">end</span>;</span><br><span class="line">                  <span class="keyword">end</span> ;</span><br><span class="line">              intcon,charcon :</span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                  <span class="keyword">if</span> sym = intcon <span class="keyword">then</span> x.typ:=ints</span><br><span class="line">                                <span class="keyword">else</span> x.typ:=chars;</span><br><span class="line">                  x.ref:=<span class="number">0</span>;</span><br><span class="line">                  gen(lit,<span class="number">0</span>,num);</span><br><span class="line">                  getsym</span><br><span class="line">                <span class="keyword">end</span>;</span><br><span class="line">              lparen :</span><br><span class="line">                  <span class="keyword">begin</span></span><br><span class="line">                    getsym;</span><br><span class="line">                    expression([rparen]+fsys,x);</span><br><span class="line">                    <span class="keyword">if</span> sym=rparen <span class="keyword">then</span> getsym</span><br><span class="line">                    <span class="keyword">else</span> error(<span class="number">25</span>)</span><br><span class="line">                  <span class="keyword">end</span>;</span><br><span class="line">              notsym :</span><br><span class="line">                  <span class="keyword">begin</span></span><br><span class="line">                    getsym;</span><br><span class="line">                    factor(fsys,x);</span><br><span class="line">                    <span class="keyword">if</span> x.typ = bool</span><br><span class="line">                      <span class="keyword">then</span> gen(nots ,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                      <span class="keyword">else</span> error(<span class="number">43</span>)</span><br><span class="line">                  <span class="keyword">end</span>;</span><br><span class="line">              <span class="keyword">end</span> ;<span class="comment">&#123; case &#125;</span></span><br><span class="line">              test(fsys+[rbrack,rparen],facbegsys,<span class="number">23</span>)</span><br><span class="line">            <span class="keyword">end</span>  <span class="comment">&#123; of if &#125;</span></span><br><span class="line">          <span class="keyword">end</span>;  <span class="comment">&#123; factor &#125;</span></span><br><span class="line">        <span class="keyword">begin</span>   <span class="comment">&#123; term &#125;</span></span><br><span class="line">          factor(fsys+[times,divsym,modsym,andsym],x);</span><br><span class="line">          <span class="keyword">while</span> sym <span class="keyword">in</span> [times,divsym,modsym,andsym] <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">begin</span></span><br><span class="line">              mulop:=sym; getsym;</span><br><span class="line">              factor(fsys+[times,divsym,modsym,andsym],y);</span><br><span class="line">              <span class="keyword">if</span> x.typ&lt;&gt;y.typ</span><br><span class="line">                <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">                       error(<span class="number">40</span>);</span><br><span class="line">                       x.typ:=notyp;</span><br><span class="line">                       x.ref:=<span class="number">0</span></span><br><span class="line">                     <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                  <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> mulop=times <span class="keyword">then</span></span><br><span class="line">                        <span class="keyword">if</span> x.typ = ints</span><br><span class="line">                          <span class="keyword">then</span> gen(mult,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                          <span class="keyword">else</span> error(<span class="number">43</span>);</span><br><span class="line">                    <span class="keyword">if</span>  mulop=divsym <span class="keyword">then</span></span><br><span class="line">                        <span class="keyword">if</span> x.typ = ints</span><br><span class="line">                          <span class="keyword">then</span> gen(idiv,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                          <span class="keyword">else</span> error(<span class="number">43</span>);</span><br><span class="line">                    <span class="keyword">if</span>  mulop=modsym <span class="keyword">then</span></span><br><span class="line">                        <span class="keyword">if</span> x.typ = ints</span><br><span class="line">                          <span class="keyword">then</span> gen(imod,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                          <span class="keyword">else</span> error(<span class="number">43</span>);</span><br><span class="line">                    <span class="keyword">if</span>  mulop=andsym <span class="keyword">then</span></span><br><span class="line">                      <span class="keyword">if</span> x.typ = bool</span><br><span class="line">                          <span class="keyword">then</span> gen(ands,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                          <span class="keyword">else</span> error(<span class="number">43</span>)</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span>;  <span class="comment">&#123; term&#125;</span></span><br><span class="line">      <span class="keyword">begin</span>  <span class="comment">&#123; simpleexpression &#125;</span></span><br><span class="line">        <span class="keyword">if</span> sym <span class="keyword">in</span> [plus,minus] <span class="keyword">then</span></span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">            addop:=sym; getsym;</span><br><span class="line">            term(fsys+[plus,minus,orsym],x);</span><br><span class="line">            <span class="keyword">if</span> addop=minus <span class="keyword">then</span> gen(mus,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">          <span class="keyword">end</span>  <span class="keyword">else</span> term(fsys+[plus,minus,orsym],x);</span><br><span class="line">        <span class="keyword">while</span> sym <span class="keyword">in</span> [plus,minus,orsym] <span class="keyword">do</span></span><br><span class="line">          <span class="keyword">begin</span> addop:=sym; getsym;</span><br><span class="line">                term(fsys+[plus,minus,orsym],y);</span><br><span class="line">                <span class="keyword">if</span> x.typ&lt;&gt;y.typ</span><br><span class="line">                <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">                       error(<span class="number">40</span>);</span><br><span class="line">                       x.typ:=notyp;</span><br><span class="line">                       x.ref:=<span class="number">0</span></span><br><span class="line">                     <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                  <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> addop=plus <span class="keyword">then</span></span><br><span class="line">                        <span class="keyword">if</span> x.typ = ints</span><br><span class="line">                          <span class="keyword">then</span> gen(<span class="keyword">add</span>,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                          <span class="keyword">else</span> error(<span class="number">43</span>);</span><br><span class="line">                    <span class="keyword">if</span>  addop=minus <span class="keyword">then</span></span><br><span class="line">                        <span class="keyword">if</span> x.typ = ints</span><br><span class="line">                          <span class="keyword">then</span> gen(sub,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                          <span class="keyword">else</span> error(<span class="number">43</span>);</span><br><span class="line">                    <span class="keyword">if</span>  addop=orsym <span class="keyword">then</span></span><br><span class="line">                      <span class="keyword">if</span> x.typ = bool</span><br><span class="line">                          <span class="keyword">then</span> gen(ors,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                          <span class="keyword">else</span> error(<span class="number">43</span>)</span><br><span class="line">                 <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span>;   <span class="comment">&#123; simpleexpression &#125;</span></span><br><span class="line">    <span class="keyword">begin</span>  <span class="comment">&#123;expression&#125;</span></span><br><span class="line">       simpleexpression([eql,neq,lss,gtr,leq,geq]+fsys,x);</span><br><span class="line">       <span class="keyword">while</span> (sym <span class="keyword">in</span> [eql,neq,lss,leq,gtr,geq]) <span class="keyword">do</span></span><br><span class="line">         <span class="keyword">begin</span></span><br><span class="line">           relop:=sym; getsym; simpleexpression(fsys,y);</span><br><span class="line">           <span class="keyword">if</span> x.typ&lt;&gt; y.typ</span><br><span class="line">             <span class="keyword">then</span> error(<span class="number">40</span>);</span><br><span class="line">           <span class="keyword">case</span> relop <span class="keyword">of</span></span><br><span class="line">             eql:gen(eq,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">             neq:gen(ne,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">             lss:gen(ls,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">             geq:gen(ge,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">             gtr:gen(gt,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">             leq:gen(le,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">           <span class="keyword">end</span>;</span><br><span class="line">           x.typ:=bool</span><br><span class="line">         <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>;       <span class="comment">&#123; expression &#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">procedure</span> <span class="title">arrayelement</span><span class="params">(fsys:symset;<span class="keyword">var</span> x:item)</span>;</span></span><br><span class="line">      <span class="keyword">var</span> cc:integer;</span><br><span class="line">          addr,p:<span class="keyword">index</span>;</span><br><span class="line">          y:item;</span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">      p:=x.ref;</span><br><span class="line">      <span class="keyword">if</span> sym=lbrack <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          <span class="keyword">repeat</span></span><br><span class="line">            getsym;</span><br><span class="line">            expression(fsys+[comma],y);</span><br><span class="line">            <span class="keyword">if</span> x.typ &lt;&gt; arrays <span class="keyword">then</span> error(<span class="number">40</span>)</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">              <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> y.typ &lt;&gt; atab[p].inxtyp <span class="keyword">then</span> error(<span class="number">44</span>);</span><br><span class="line">                gen(lit,<span class="number">0</span>,atab[p].low);</span><br><span class="line">                gen(sub,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                gen(lit,<span class="number">1</span>,atab[p].elsize);</span><br><span class="line">                gen(mult,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                gen(<span class="keyword">add</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                x.typ:=atab[p].eltyp;</span><br><span class="line">                x.ref:=atab[p].elref;</span><br><span class="line">                p:=atab[p].elref;</span><br><span class="line">              <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">until</span> sym &lt;&gt; comma;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> sym=rbrack <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">28</span>);</span><br><span class="line">        <span class="keyword">end</span> <span class="keyword">else</span> error(<span class="number">16</span>);</span><br><span class="line">      test(fsys,[],<span class="number">13</span>);</span><br><span class="line">    <span class="keyword">end</span>;         <span class="comment">&#123;arrayelement&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">procedure</span> <span class="title">assignment</span>;</span>  </span><br><span class="line">    <span class="keyword">var</span> x,y:item;</span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        i:=position(id);</span><br><span class="line">        <span class="keyword">if</span> i=<span class="number">0</span> <span class="keyword">then</span> error(<span class="number">10</span>)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="keyword">if</span> nametab[i].kind&lt;&gt;variable <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">begin</span>  <span class="comment">&#123; giving value to non-variation &#125;</span></span><br><span class="line">              error(<span class="number">30</span>);  i:=<span class="number">0</span></span><br><span class="line">            <span class="keyword">end</span>;</span><br><span class="line">        getsym;</span><br><span class="line">        x.typ:=nametab[i].typ;</span><br><span class="line">        x.ref:=nametab[i].ref;</span><br><span class="line">        <span class="keyword">with</span> nametab[i] <span class="keyword">do</span></span><br><span class="line">          <span class="keyword">if</span> normal</span><br><span class="line">            <span class="keyword">then</span> gen(loda,lev,adr)   </span><br><span class="line">            <span class="keyword">else</span> gen(lod,lev,adr);  </span><br><span class="line">        <span class="keyword">if</span> sym = lbrack  </span><br><span class="line">            <span class="keyword">then</span> arrayelement(fsys+[becomes],x);</span><br><span class="line">        <span class="keyword">if</span> sym = becomes <span class="keyword">then</span> getsym</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                     error(<span class="number">33</span>);</span><br><span class="line">                     <span class="keyword">if</span> sym=eql <span class="keyword">then</span> getsym</span><br><span class="line">                   <span class="keyword">end</span>;</span><br><span class="line">         expression(fsys,y);</span><br><span class="line">         <span class="keyword">if</span> x.typ &lt;&gt; y.typ <span class="keyword">then</span> error(<span class="number">40</span>)</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">           <span class="keyword">if</span> x.typ = arrays</span><br><span class="line">             <span class="keyword">then</span> <span class="keyword">if</span> x.ref = y.ref</span><br><span class="line">                     <span class="keyword">then</span> gen(cpyb,<span class="number">0</span>,atab[x.ref].size)  </span><br><span class="line">                     <span class="keyword">else</span> error(<span class="number">40</span>)</span><br><span class="line">             <span class="keyword">else</span> gen(sto,<span class="number">0</span>,<span class="number">0</span>);   </span><br><span class="line">      <span class="keyword">end</span>;      </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        </span><br><span class="line">     <span class="function"><span class="keyword">procedure</span> <span class="title">ifstatement</span>;</span>         </span><br><span class="line">       <span class="keyword">var</span> x:item;</span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">         getsym; expression([thensym,dosym]+fsys,x);</span><br><span class="line">         <span class="keyword">if</span> x.typ &lt;&gt; bool <span class="keyword">then</span> error(<span class="number">34</span>);</span><br><span class="line">         <span class="keyword">if</span> sym=thensym <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">35</span>);</span><br><span class="line">         cx1:=cx; gen(jpc,<span class="number">0</span>,<span class="number">0</span>);  </span><br><span class="line">         statement(fsys+[elsesym]);   </span><br><span class="line">         <span class="keyword">if</span> sym = elsesym</span><br><span class="line">           <span class="keyword">then</span>  <span class="keyword">begin</span></span><br><span class="line">             getsym;</span><br><span class="line">             cx2:=cx; gen(jmp,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">             code[cx1].a:=cx;   </span><br><span class="line">             labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">             statement(fsys);</span><br><span class="line">             code[cx2].a:=cx;   </span><br><span class="line">             labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">           <span class="keyword">end</span></span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             <span class="keyword">begin</span>     </span><br><span class="line">               code[cx1].a:=cx;</span><br><span class="line">               labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">             <span class="keyword">end</span></span><br><span class="line">       <span class="keyword">end</span>;           <span class="comment">&#123;ifstatement&#125;</span></span><br><span class="line"> </span><br><span class="line">     <span class="function"><span class="keyword">procedure</span> <span class="title">casestatement</span>;</span>   <span class="comment">&#123;case&#125;</span></span><br><span class="line">         <span class="keyword">var</span> x:item;</span><br><span class="line">             coni,conj:integer; </span><br><span class="line">         <span class="keyword">begin</span></span><br><span class="line">                getsym;cx1:=cx;</span><br><span class="line">                expression([ofsym]+fsys,x);cx2:=cx;</span><br><span class="line">              <span class="keyword">if</span> (x.typ = ints) <span class="keyword">or</span> (x.typ = chars)<span class="keyword">then</span> </span><br><span class="line">               <span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> sym=ofsym <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                 getsym;conj:=<span class="number">0</span>;</span><br><span class="line">                 <span class="keyword">while</span> sym&lt;&gt;elsesym <span class="keyword">do</span> </span><br><span class="line">                 <span class="keyword">begin</span></span><br><span class="line">                     <span class="keyword">if</span> (sym = intcon) <span class="keyword">or</span> (sym = charcon) <span class="keyword">then</span></span><br><span class="line">                     <span class="keyword">begin</span></span><br><span class="line">                    coni:=cx1;</span><br><span class="line">                      <span class="keyword">if</span> conj&lt;&gt;<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">                      <span class="keyword">begin</span></span><br><span class="line">                      <span class="keyword">while</span> coni&lt;cx2 <span class="keyword">do</span></span><br><span class="line">                      <span class="keyword">begin</span></span><br><span class="line">                        code[cx]:=code[coni];</span><br><span class="line">                         cx:=cx+<span class="number">1</span>;</span><br><span class="line">                         coni:=coni+<span class="number">1</span>;</span><br><span class="line">                      <span class="keyword">end</span></span><br><span class="line">                      <span class="keyword">end</span>;</span><br><span class="line">                      conj:=<span class="number">1</span>;</span><br><span class="line">                      gen(lit,<span class="number">0</span>,num);</span><br><span class="line">                      coni:=cx1;</span><br><span class="line">                      <span class="keyword">end</span></span><br><span class="line">                      <span class="keyword">else</span> error(<span class="number">12</span>);</span><br><span class="line">                      getsym;</span><br><span class="line">                       <span class="keyword">if</span> sym=colon <span class="keyword">then</span></span><br><span class="line">                       <span class="keyword">begin</span></span><br><span class="line">                          getsym;</span><br><span class="line">                          gen(eq,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                          cx2:=cx;</span><br><span class="line">                            gen(jpc,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                            statement([semicolon]+fsys);</span><br><span class="line">                       <span class="keyword">if</span> sym=semicolon <span class="keyword">then</span></span><br><span class="line">                       <span class="keyword">begin</span></span><br><span class="line">                        getsym;</span><br><span class="line">                        labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">                        gen(jmp,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                        code[cx2].a:=cx</span><br><span class="line">                         <span class="keyword">end</span></span><br><span class="line">                       <span class="keyword">else</span> error(<span class="number">23</span>)</span><br><span class="line">                      <span class="keyword">end</span></span><br><span class="line">                      <span class="keyword">else</span>  error(<span class="number">24</span>)<span class="comment">&#123;colon&#125;</span></span><br><span class="line">                     <span class="keyword">end</span>;</span><br><span class="line">                   <span class="keyword">if</span> sym=elsesym <span class="keyword">then</span></span><br><span class="line">                     <span class="keyword">begin</span></span><br><span class="line">                        getsym;</span><br><span class="line">                    statement([endsym]+fsys);</span><br><span class="line">                        lx:=lx-<span class="number">1</span>;</span><br><span class="line">                         <span class="keyword">while</span> lx&gt;=<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">                         <span class="keyword">begin</span> code[labtab[lx]].a:=cx;</span><br><span class="line">                        lx:=lx-<span class="number">1</span></span><br><span class="line">                         <span class="keyword">end</span></span><br><span class="line">                  <span class="keyword">end</span>;</span><br><span class="line">                  <span class="keyword">if</span> sym=endsym <span class="keyword">then</span> getsym</span><br><span class="line">                  <span class="keyword">else</span> error(<span class="number">36</span>)</span><br><span class="line">              <span class="keyword">end</span></span><br><span class="line">              <span class="keyword">else</span> error(<span class="number">17</span>)</span><br><span class="line">             <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">compound</span>;</span>   </span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        getsym; statement([semicolon,endsym]+fsys);</span><br><span class="line">        <span class="keyword">while</span> sym <span class="keyword">in</span> ([semicolon]+statbegsys) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          <span class="keyword">if</span> sym=semicolon <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">23</span>);</span><br><span class="line">          statement([semicolon,endsym]+fsys) </span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">        <span class="keyword">if</span> sym=endsym <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">36</span>)</span><br><span class="line">      <span class="keyword">end</span>;         <span class="comment">&#123;compound&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">whilestatement</span>;</span> </span><br><span class="line">      <span class="keyword">var</span> x:item;</span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        getsym;</span><br><span class="line">        labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">        cx1:=cx; expression([dosym]+fsys,x);    </span><br><span class="line">        <span class="keyword">if</span> x.typ &lt;&gt; bool <span class="keyword">then</span> error(<span class="number">34</span>);</span><br><span class="line">        cx2:=cx; gen(jpc,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span> sym=dosym <span class="keyword">then</span> getsym <span class="keyword">else</span> error(<span class="number">37</span>);</span><br><span class="line">        statement(fsys); gen(jmp,<span class="number">0</span>,cx1); code[cx2].a:=cx;</span><br><span class="line">        labtab[lx]:=cx;lx:=lx+<span class="number">1</span></span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">      </span><br><span class="line">      <span class="function"><span class="keyword">procedure</span> <span class="title">repeatstatement</span>;</span><span class="comment">&#123;repeat&#125;</span></span><br><span class="line">      <span class="keyword">var</span> x:item;</span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        getsym;cx1:=cx; labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">        statement([untilsym]+fsys);</span><br><span class="line">        <span class="keyword">if</span> sym&lt;&gt;semicolon <span class="keyword">then</span> error(<span class="number">23</span>);</span><br><span class="line">        getsym;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">not</span> (sym <span class="keyword">in</span> ([untilsym]))) <span class="keyword">do</span></span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">           statement([untilsym]+fsys);</span><br><span class="line">           <span class="keyword">if</span> sym&lt;&gt;semicolon <span class="keyword">then</span> error(<span class="number">23</span>);</span><br><span class="line">           getsym</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span> sym=untilsym <span class="keyword">then</span> </span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">            getsym;</span><br><span class="line">            expression([endsym]+fsys,x);</span><br><span class="line">            <span class="keyword">if</span> x.typ &lt;&gt; bool <span class="keyword">then</span> error(<span class="number">34</span>); </span><br><span class="line">            gen(jpc,<span class="number">0</span>,cx1);labtab[lx]:=cx;lx:=lx+<span class="number">1</span></span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">        </span><br><span class="line">                </span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">forstatement</span>;</span><span class="comment">&#123;for&#125;</span></span><br><span class="line"><span class="keyword">var</span> x,ini,fin:item;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">     getsym;</span><br><span class="line">     <span class="keyword">if</span> sym=ident <span class="keyword">then</span></span><br><span class="line">     <span class="keyword">begin</span> </span><br><span class="line">             i:=position(id);getsym;</span><br><span class="line">             <span class="keyword">if</span> i=<span class="number">0</span> <span class="keyword">then</span> error(<span class="number">10</span>)</span><br><span class="line">             <span class="keyword">else</span></span><br><span class="line">                  <span class="keyword">if</span> nametab[i].kind&lt;&gt;variable <span class="keyword">then</span></span><br><span class="line">                     <span class="keyword">begin</span></span><br><span class="line">                     error(<span class="number">30</span>);i:=<span class="number">0</span></span><br><span class="line">                     <span class="keyword">end</span> </span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                     <span class="keyword">begin</span></span><br><span class="line">                        x.typ:=nametab[i].typ;</span><br><span class="line">            x.ref:=nametab[i].ref; </span><br><span class="line">            <span class="keyword">if</span> nametab[i].normal  </span><br><span class="line">            <span class="keyword">then</span> gen(loda,nametab[i].lev,nametab[i].adr)</span><br><span class="line">            <span class="keyword">else</span> gen(lod,nametab[i].lev,nametab[i].adr)</span><br><span class="line">           <span class="keyword">end</span>;</span><br><span class="line">       <span class="keyword">if</span> sym=becomes <span class="keyword">then</span> </span><br><span class="line">       <span class="keyword">begin</span></span><br><span class="line">           getsym;</span><br><span class="line">           expression([tosym]+fsys,ini);</span><br><span class="line">             <span class="keyword">if</span>  ini.typ&lt;&gt;ints <span class="keyword">then</span> error(<span class="number">12</span>)</span><br><span class="line">             <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                     gen(sto,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                     <span class="keyword">if</span> sym=tosym <span class="keyword">then</span></span><br><span class="line">                         <span class="keyword">begin</span></span><br><span class="line">                            getsym;cx1:=cx;labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">                            gen(loda,nametab[i].lev,nametab[i].adr);</span><br><span class="line">                            gen(lodt,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                            expression([dosym]+fsys,fin);</span><br><span class="line">                          <span class="keyword">if</span> sym=dosym <span class="keyword">then</span></span><br><span class="line">                               <span class="keyword">begin</span></span><br><span class="line">                                 gen(le,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                                 cx2:=cx;labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">                                 gen(jpc,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                                     getsym;</span><br><span class="line">                                   statement(fsys);</span><br><span class="line">                                     <span class="keyword">if</span> nametab[i].normal <span class="keyword">then</span></span><br><span class="line">                                     <span class="keyword">begin</span></span><br><span class="line">                                         gen(loda,nametab[i].lev,nametab[i].adr);</span><br><span class="line">                                         gen(loda,nametab[i].lev,nametab[i].adr);</span><br><span class="line">                           gen(lodt,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                                     <span class="keyword">end</span></span><br><span class="line">                                     <span class="keyword">else</span> gen(lod,nametab[i].lev,nametab[i].adr);</span><br><span class="line">                                     gen(lit,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">                                     gen(<span class="keyword">add</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                         gen(sto,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">                         gen(jmp,<span class="number">0</span>,cx1);</span><br><span class="line">                         code[cx2].a:=cx</span><br><span class="line">                                 <span class="keyword">end</span></span><br><span class="line">                         <span class="keyword">end</span></span><br><span class="line">                      <span class="keyword">end</span></span><br><span class="line">       <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">end</span></span><br><span class="line">   <span class="keyword">else</span> error(<span class="number">33</span>)</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line">                    </span><br><span class="line">           </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">           </span><br><span class="line">         </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">call</span>;</span>       </span><br><span class="line">    <span class="keyword">var</span>      x:  item;</span><br><span class="line">             lastp,cp,i,j,k:integer;</span><br><span class="line">    <span class="function"><span class="keyword">procedure</span> <span class="title">stanproc</span><span class="params">(i:integer)</span>;</span></span><br><span class="line">    <span class="keyword">var</span> n:integer;</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> i =<span class="number">6</span>  <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span>    <span class="comment">&#123; read &#125;</span></span><br><span class="line">          getsym;</span><br><span class="line">          <span class="keyword">if</span> sym=lparen <span class="keyword">then</span></span><br><span class="line">          <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">repeat</span></span><br><span class="line">              getsym;</span><br><span class="line">              <span class="keyword">if</span> sym=ident <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">begin</span></span><br><span class="line">                  n:=position(id); getsym;</span><br><span class="line">                  <span class="keyword">if</span> n=<span class="number">0</span> <span class="keyword">then</span> error(<span class="number">10</span>)</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                      <span class="keyword">if</span> nametab[n].kind&lt;&gt;variable <span class="keyword">then</span></span><br><span class="line">                         <span class="keyword">begin</span> error(<span class="number">30</span>); n:=<span class="number">0</span> <span class="keyword">end</span></span><br><span class="line">                      <span class="keyword">else</span></span><br><span class="line">                        <span class="keyword">begin</span></span><br><span class="line">                          x.typ:=nametab[n].typ;</span><br><span class="line">                          x.ref:=nametab[n].ref;</span><br><span class="line">                          <span class="keyword">if</span> nametab[n].normal</span><br><span class="line">                            <span class="keyword">then</span> gen(loda,nametab[n].lev,nametab[n].adr)</span><br><span class="line">                            <span class="keyword">else</span> gen(lod,nametab[n].lev,nametab[n].adr);</span><br><span class="line">                          <span class="keyword">if</span> sym = lbrack</span><br><span class="line">                             <span class="keyword">then</span> arrayelement(fsys+[comma],x);</span><br><span class="line">                          <span class="keyword">if</span> x.typ = ints</span><br><span class="line">                            <span class="keyword">then</span> gen(red,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                            <span class="keyword">else</span> <span class="keyword">if</span> x.typ = chars</span><br><span class="line">                                   <span class="keyword">then</span> gen(red,<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">                                   <span class="keyword">else</span> error(<span class="number">43</span>)</span><br><span class="line">                        <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> error(<span class="number">22</span>)</span><br><span class="line">              <span class="keyword">until</span> sym&lt;&gt;comma;</span><br><span class="line">              <span class="keyword">if</span> sym&lt;&gt;rparen <span class="keyword">then</span> error(<span class="number">25</span>)</span><br><span class="line">                               <span class="keyword">else</span>  getsym</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> error(<span class="number">32</span>)</span><br><span class="line">          <span class="keyword">end</span></span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">if</span> i = <span class="number">7</span> <span class="keyword">then</span></span><br><span class="line">              <span class="keyword">begin</span>        <span class="comment">&#123; write &#125;</span></span><br><span class="line">                getsym;</span><br><span class="line">                <span class="keyword">if</span> sym=lparen <span class="keyword">then</span></span><br><span class="line">                  <span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">repeat</span></span><br><span class="line">                      getsym;</span><br><span class="line">                      expression([rparen,comma]+fsys,x);</span><br><span class="line">                      <span class="keyword">if</span> x.typ = ints</span><br><span class="line">                        <span class="keyword">then</span> gen(wrt,<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> x.typ = chars</span><br><span class="line">                               <span class="keyword">then</span> gen(wrt,<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">                               <span class="keyword">else</span> error(<span class="number">43</span>)</span><br><span class="line">                    <span class="keyword">until</span> sym&lt;&gt;comma;</span><br><span class="line">                    <span class="keyword">if</span> sym&lt;&gt;rparen <span class="keyword">then</span> error(<span class="number">25</span>);</span><br><span class="line">                    getsym</span><br><span class="line">                  <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> error(<span class="number">32</span>)</span><br><span class="line">             <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>;    <span class="comment">&#123; standproc &#125;</span></span><br><span class="line">    <span class="keyword">begin</span>    <span class="comment">&#123; call &#125;</span></span><br><span class="line">      getsym;</span><br><span class="line">      <span class="keyword">if</span> sym = ident  <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        i:=position(id);</span><br><span class="line">        <span class="keyword">if</span> nametab[i].kind = prosedure <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          <span class="keyword">if</span> nametab[i].lev = <span class="number">0</span> <span class="keyword">then</span> stanproc(i)</span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            getsym;</span><br><span class="line">            gen(opac,<span class="number">0</span>,<span class="number">0</span>);  <span class="comment">&#123;open active record&#125;</span></span><br><span class="line">            lastp :=btab[nametab[i].ref].lastpar;</span><br><span class="line">            cp :=i;</span><br><span class="line">            <span class="keyword">if</span> sym=lparen</span><br><span class="line">            <span class="keyword">then</span> <span class="keyword">begin</span> <span class="comment">&#123;actual parameter list&#125;</span></span><br><span class="line">            <span class="keyword">repeat</span></span><br><span class="line">              getsym;</span><br><span class="line">              <span class="keyword">if</span> cp&gt;=lastp</span><br><span class="line">              <span class="keyword">then</span> error(<span class="number">29</span>)</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                cp :=cp+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> nametab[cp].normal  <span class="keyword">then</span></span><br><span class="line">                <span class="keyword">begin</span> <span class="comment">&#123;value parameter&#125;</span></span><br><span class="line">                  expression(fsys+[comma,colon,rparen],x);</span><br><span class="line">                  <span class="keyword">if</span> x.typ = nametab[cp].typ <span class="keyword">then</span></span><br><span class="line">                    <span class="keyword">begin</span></span><br><span class="line">                      <span class="keyword">if</span> x.ref &lt;&gt; nametab[cp].ref</span><br><span class="line">                        <span class="keyword">then</span> error(<span class="number">31</span>)</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> x.typ = arrays</span><br><span class="line">                               <span class="keyword">then</span> gen(lodb,<span class="number">0</span>,atab[x.ref].size)</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                  <span class="keyword">else</span> error(<span class="number">31</span>)</span><br><span class="line">                <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">begin</span> <span class="comment">&#123;variable parameter&#125;</span></span><br><span class="line">                  <span class="keyword">if</span> sym &lt;&gt; ident</span><br><span class="line">                  <span class="keyword">then</span> error(<span class="number">22</span>)</span><br><span class="line">                  <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                    k:=position(id);</span><br><span class="line">                    getsym;</span><br><span class="line">                    <span class="keyword">if</span> k&lt;&gt;<span class="number">0</span></span><br><span class="line">                    <span class="keyword">then</span> <span class="keyword">begin</span></span><br><span class="line">                      <span class="keyword">if</span> nametab[k].kind&lt;&gt;variable <span class="keyword">then</span> error (<span class="number">30</span>);</span><br><span class="line">                      x.typ :=nametab[k].typ;</span><br><span class="line">                      x.ref :=nametab[k].ref;</span><br><span class="line">                      <span class="keyword">if</span> nametab[k].normal</span><br><span class="line">                      <span class="keyword">then</span> gen(loda,nametab[k].lev,nametab[k].adr)</span><br><span class="line">                      <span class="keyword">else</span> gen(lod,nametab[k].lev,nametab[k].adr);</span><br><span class="line">                      <span class="keyword">if</span> sym = lbrack</span><br><span class="line">                        <span class="keyword">then</span>  arrayelement(fsys+[comma,rparen],x);</span><br><span class="line">                      <span class="keyword">if</span>    (nametab[cp].typ&lt;&gt;x.typ)</span><br><span class="line">                        <span class="keyword">or</span> (nametab[cp].ref&lt;&gt;x.ref)</span><br><span class="line">                         <span class="keyword">then</span> error(<span class="number">31</span>);</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                  <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span> <span class="comment">&#123;variable parameter&#125;</span></span><br><span class="line">              <span class="keyword">end</span>;</span><br><span class="line">              test([comma,rparen],fsys,<span class="number">13</span>)</span><br><span class="line">            <span class="keyword">until</span> sym &lt;&gt; comma;</span><br><span class="line">            <span class="keyword">if</span> sym=rparen <span class="keyword">then</span> getsym  <span class="keyword">else</span> error(<span class="number">25</span>)</span><br><span class="line">          <span class="keyword">end</span>;</span><br><span class="line">          <span class="keyword">if</span> cp &lt; lastp <span class="keyword">then</span> error(<span class="number">39</span>);<span class="comment">&#123;too few actual parameters&#125;</span></span><br><span class="line">          gen(cal,nametab[i].lev,nametab[i].adr);</span><br><span class="line">          <span class="keyword">if</span> nametab[i].lev&lt;level <span class="keyword">then</span> gen(udis,nametab[i].lev,level)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">end</span> <span class="keyword">else</span> error(<span class="number">51</span>)</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> error(<span class="number">22</span>);</span><br><span class="line">    test(fsys+[ident],[],<span class="number">13</span>)</span><br><span class="line">  <span class="keyword">end</span> <span class="comment">&#123;call&#125;</span>;</span><br><span class="line">    <span class="keyword">begin</span>  <span class="comment">&#123; statement &#125;</span></span><br><span class="line">      test(statbegsys+[ident],fsys,<span class="number">13</span>);</span><br><span class="line">      <span class="keyword">if</span> sym=ident <span class="keyword">then</span>  assignment</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> sym=callsym <span class="keyword">then</span> call</span><br><span class="line">      <span class="keyword">else</span>   <span class="keyword">if</span> sym=ifsym <span class="keyword">then</span>  ifstatement</span><br><span class="line">      <span class="keyword">else</span>   <span class="keyword">if</span> sym=casesym <span class="keyword">then</span>  casestatement</span><br><span class="line">      <span class="keyword">else</span>   <span class="keyword">if</span> sym=repeatsym <span class="keyword">then</span> repeatstatement</span><br><span class="line">        <span class="keyword">else</span>   <span class="keyword">if</span> sym=forsym <span class="keyword">then</span> forstatement</span><br><span class="line">      <span class="keyword">else</span>   <span class="keyword">if</span> sym=beginsym <span class="keyword">then</span> compound</span><br><span class="line">      <span class="keyword">else</span>    <span class="keyword">if</span> sym=whilesym <span class="keyword">then</span> whilestatement;</span><br><span class="line">      test(fsys+[elsesym],[],<span class="number">13</span>)</span><br><span class="line">    <span class="keyword">end</span>;  <span class="comment">&#123; statement &#125;</span></span><br><span class="line">  <span class="keyword">begin</span>   <span class="comment">&#123; block &#125;</span></span><br><span class="line">    prt:=tx;  <span class="comment">&#123;tx为TABLE表的表头索引&#125;</span></span><br><span class="line">    dx:=<span class="number">3</span>;  <span class="comment">&#123;每个过程中变量的相对起始位置在BLOCK内置初值DX∶=3&#125;</span></span><br><span class="line">    tx0:=tx; nametab[tx].adr:=cx;</span><br><span class="line">    <span class="keyword">if</span> level &gt; levmax <span class="keyword">then</span> error(<span class="number">4</span>);</span><br><span class="line">    enterblock ;</span><br><span class="line">    prb:=bx;  display[level]:=bx;</span><br><span class="line">    nametab[prt].typ:=notyp;  nametab[prt].ref:=prb;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(sym=lparen) <span class="keyword">and</span> (level&gt;<span class="number">1</span>)</span><br><span class="line">      <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          paramenterlist;</span><br><span class="line">          <span class="keyword">if</span> sym=semicolon <span class="keyword">then</span> getsym</span><br><span class="line">                           <span class="keyword">else</span> error(<span class="number">23</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">      <span class="keyword">else</span>  <span class="keyword">if</span> level&gt;<span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">              <span class="keyword">if</span> sym=semicolon <span class="keyword">then</span> getsym</span><br><span class="line">                            <span class="keyword">else</span> error(<span class="number">23</span>);</span><br><span class="line">    btab[prb].lastpar:=tx;</span><br><span class="line">    btab[prb].psize:=dx;</span><br><span class="line"></span><br><span class="line">    gen(jmp,<span class="number">0</span>,<span class="number">0</span>);  <span class="comment">&#123; jump from declaration part to statement part &#125;</span></span><br><span class="line">    <span class="keyword">repeat</span></span><br><span class="line">      <span class="keyword">if</span> sym=constsym <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          getsym;</span><br><span class="line">          <span class="keyword">repeat</span></span><br><span class="line">            constdeclaration;</span><br><span class="line">          <span class="keyword">until</span> sym&lt;&gt;ident</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">      <span class="keyword">if</span> sym=typesym <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          getsym;</span><br><span class="line">          <span class="keyword">repeat</span></span><br><span class="line">            typedeclaration;</span><br><span class="line">          <span class="keyword">until</span> sym&lt;&gt;ident</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">      <span class="keyword">if</span> sym=varsym <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          getsym;</span><br><span class="line">          <span class="keyword">repeat</span></span><br><span class="line">            vardeclaration;</span><br><span class="line">          <span class="keyword">until</span> sym&lt;&gt;ident;</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">      <span class="keyword">while</span> sym=procsym <span class="keyword">do</span>   procdeclaration;</span><br><span class="line">      test(statbegsys+[ident],declbegsys,<span class="number">13</span>)</span><br><span class="line">    <span class="keyword">until</span> <span class="keyword">not</span> (sym <span class="keyword">in</span> declbegsys);</span><br><span class="line">    code[nametab[tx0].adr].a:=cx;  <span class="comment">&#123;back enter statement code's start adr. &#125;</span></span><br><span class="line">    labtab[lx]:=cx;lx:=lx+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">with</span> nametab[tx0] <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        adr:=cx;  <span class="comment">&#123;code's start address &#125;</span></span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">    cx0:=cx;</span><br><span class="line">    gen(entp,level,dx);  <span class="comment">&#123; block entry &#125;</span></span><br><span class="line">    statement([semicolon,endsym]+fsys);</span><br><span class="line">    <span class="keyword">if</span> level&gt;<span class="number">1</span> <span class="keyword">then</span> gen(retp,<span class="number">0</span>,<span class="number">0</span>)  <span class="comment">&#123;return&#125;</span></span><br><span class="line">               <span class="keyword">else</span> gen(endp,<span class="number">0</span>,<span class="number">0</span>);  <span class="comment">&#123; end prograam &#125;</span></span><br><span class="line">    test(fsys,[],<span class="number">13</span>);</span><br><span class="line">    listcode;</span><br><span class="line">  <span class="keyword">end</span>;   <span class="comment">&#123; block &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&#123;************************************************************************&#125;</span></span><br><span class="line"><span class="keyword">begin</span>  <span class="comment">&#123; main &#125;</span></span><br><span class="line">  writeln(<span class="string">'Please input source program file name:'</span>);</span><br><span class="line">  readln(sfilename);</span><br><span class="line">  assign(sfile,sfilename);</span><br><span class="line">  reset(sfile);</span><br><span class="line"></span><br><span class="line">  fsplit(sfilename,dir, name,ext);  </span><br><span class="line">  listfilename:=dir +name+<span class="string">'.LST'</span>;</span><br><span class="line">  assign(listfile,listfilename);</span><br><span class="line">  rewrite(listfile);</span><br><span class="line"></span><br><span class="line">  initial;</span><br><span class="line">  enterpreid;</span><br><span class="line">  getsym;</span><br><span class="line">  <span class="keyword">if</span> sym = programsym <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      getsym;</span><br><span class="line">      <span class="keyword">if</span> sym = ident <span class="keyword">then</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">          getsym;</span><br><span class="line">          <span class="keyword">if</span> sym = semicolon <span class="keyword">then</span> getsym</span><br><span class="line">          <span class="keyword">else</span> error(<span class="number">23</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> error(<span class="number">22</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> error(<span class="number">15</span>);</span><br><span class="line">    test(declbegsys+[beginsym],[],<span class="number">13</span>);</span><br><span class="line">  <span class="keyword">block</span>([period]+declbegsys+statbegsys,<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> sym&lt;&gt;period <span class="keyword">then</span> error(<span class="number">38</span>);</span><br><span class="line">  <span class="keyword">if</span> err=<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">       <span class="keyword">write</span>(<span class="string">'SUCCESS'</span>);</span><br><span class="line">       assign(fcode,dir+name+<span class="string">'.pld'</span>);</span><br><span class="line">       rewrite(fcode);</span><br><span class="line">       <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> cx <span class="keyword">do</span></span><br><span class="line">         <span class="keyword">write</span>(fcode,code[i]);</span><br><span class="line">       close(fcode);</span><br><span class="line">       assign(labfile,dir+name+<span class="string">'.lab'</span>);</span><br><span class="line">       rewrite(labfile);</span><br><span class="line">       <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> lx <span class="keyword">do</span></span><br><span class="line">         <span class="keyword">write</span>(labfile,labtab[i]);</span><br><span class="line">       close(labfile)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">write</span>(err,<span class="string">'ERRORS IN PROGRAM'</span>);</span><br><span class="line">  writeln;</span><br><span class="line">  close(sfile);</span><br><span class="line">  close(listfile)</span><br><span class="line"> <span class="keyword">end</span>.  <span class="comment">&#123; of whole program  &#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="测试代码">测试代码</h4><h5 id="case">case</h5><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">program fsj;</span><br><span class="line">var n:integer;</span><br><span class="line">    a:char;   </span><br><span class="line">begin</span><br><span class="line">    n:=<span class="number">2</span>;</span><br><span class="line">    a:=<span class="string">'f'</span>;</span><br><span class="line">    case a of</span><br><span class="line">     <span class="number">1</span>: call <span class="keyword">write</span>(<span class="number">1</span>);</span><br><span class="line">     <span class="string">'f'</span>: call <span class="keyword">write</span>(n);</span><br><span class="line">    <span class="keyword">else</span> call <span class="keyword">write</span>(<span class="number">2</span>)</span><br><span class="line">   end</span><br><span class="line">end.</span><br></pre></td></tr></table></figure>
<h5 id="repeat">repeat</h5><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">program fsj;</span><br><span class="line">var n:integer;  </span><br><span class="line">begin</span><br><span class="line">   n:=<span class="number">1</span>;</span><br><span class="line">   repeat </span><br><span class="line">     n:=n+<span class="number">1</span>;</span><br><span class="line">   <span class="keyword">until</span> n=<span class="number">5</span>;</span><br><span class="line">call <span class="keyword">write</span>(n)</span><br><span class="line">end.</span><br></pre></td></tr></table></figure>
<h5 id="for">for</h5><figure class="highlight pl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">program fsj;</span><br><span class="line">var i,sum:integer;  </span><br><span class="line">begin</span><br><span class="line">  sum:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">3</span> to <span class="number">7</span> <span class="keyword">do</span></span><br><span class="line">     sum:=sum+i*<span class="number">2</span>;</span><br><span class="line">  call <span class="keyword">write</span>(sum)</span><br><span class="line">end.</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/compiler/">compiler</a>
  </div>

        <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone"></a><a href="#" class="bds_tsina" data-cmd="tsina"></a><a href="#" class="bds_tqq" data-cmd="tqq"></a><a href="#" class="bds_renren" data-cmd="renren"></a><a href="#" class="bds_weixin" data-cmd="weixin"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/Anatomy/">Anatomy</a><small>0</small></li>
  
    <li><a href="/tags/CS/">CS</a><small>1</small></li>
  
    <li><a href="/tags/OpenGL/">OpenGL</a><small>1</small></li>
  
    <li><a href="/tags/anatomy/">anatomy</a><small>2</small></li>
  
    <li><a href="/tags/compiler/">compiler</a><small>1</small></li>
  
    <li><a href="/tags/medicine/">medicine</a><small>0</small></li>
  
    <li><a href="/tags/military/">military</a><small>2</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2015 Victor Lee
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.useso.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
<a title="返回顶部"><img src="/imgs/scrollup.png"/></a>
</div>
<script src="/js/totop.js"></script>

</body>
</html>